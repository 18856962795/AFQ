<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of AFQ_RenderFibers</title>
  <meta name="keywords" content="AFQ_RenderFibers">
  <meta name="description" content="Render a fiber group and tract profile in 3-D">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">functions</a> &gt; AFQ_RenderFibers.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for functions&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>AFQ_RenderFibers
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Render a fiber group and tract profile in 3-D</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function lightH = AFQ_RenderFibers(fg,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Render a fiber group and tract profile in 3-D

   AFQ_RenderFibers(fg,'PropertyName',PropertyValue, ...)

 Given an mrDiffusion fiber group structure, AFQ_RenderFibers(fg), will
 make a 3-D rendering of that fiber group.  The 3-d rendering can be
 rotated with the keyboard arrow keys There are aditional optional
 arguments that can be passed into the function.  They are always defined
 by first entering the 'PropertyName' as a string, followed by the
 property value which may either be a string, a scaler or a data
 structure.  Below all the options are described.

 Options:

 AFQ_RenderFibers(fg,'dt',dtStruct) - If a dt6 structure is provided
 then the tract FA profile will be rendered along with the fiber group.
 See dtiLoadDt6 and dtiComputeDiffusionPropertiesAlongFG.

 AFQ_RenderFibers(fg,'dt',dtStruct,'rois',roi1,roi2) - If a dt6 structure
 and 2 rois are provided then the tract FA profile will onlyh be rendered
 for the portion of the tract spanning between the 2 rois.  See
 dtiReadRois

 AFQ_RenderFibers(fg,'dt',dtStruct,'crange',range) - 'crange' defines
 the color range for the tract profile.  The default is range = [0.3 0.6].
 This means that values below 0.3 will take on the minimum value of the
 color map and values above 0.6 will take on the maximum value.

 AFQ_RenderFibers(fg,'dt',dtStruct,'cmap',colormap) - 'cmap' defines the
 color map to be used for the tract profile.  The default is colormap =
 'jet'. Other options are 'autumn' 'hot' 'cool' 'winter' etc. See matlab
 help for other colormaps

 AFQ_RenderFibers(fg,'dt',dtStruct,'radius',r) - radius is a 1 by 2 vector
 that defines the radius of the tubes for the fibers and the tract
 profile. r(1) is the radius of the fibers and r(2) is the radius of the
 tract profile. Default is r = [1 5] meaning that fibers have a 1mm radius
 and the tract profile has a 5mm radius.

 AFQ_RenderFibers(fg,'tractprofile',TractProfile,'val',['fa']) - A
 tract profile can be passed in if it has been precomputed for the fiber
 tract. TractProfile is a structure created by AFQ_CreateTractProfile and
 contains the coordinates and values to be plotted. The user can also
 define which value in the tract profile should be plotted. The dafault is
 'fa' but the name of any value that exists within the TractProfile
 structure is ok.

 AFQ_RenderFibers(fg,'color', rgbValues) - Render the fiber group in a
 specific color.  rgbValues can be defined in 3 ways to do (1) uniform
 coloring for the fiber group, (2) fiberwise coloring or (3) pointwise
 coloring. 
 (1) If rgbValues is a 1 x 3 vector of rgb values than each fiber is
 colored that same color. The default color is gray [0.7 0.7 0.7]. To do
 cyan for example rgbValues = [0 1 1].
 (2) If rgbValues is a N x 3 vector where N is the number of fibers in
 the fiber group, then each fiber in the group is rendered in its own
 color. Each fiber's color is defined by the coresponding row of
 rgbValues. For example to color each fiber a random color:
 rgbValues=rand(length(fg.fibers),3)
 (3) If rgbValues is a 1 x N cell array where N is the number of fibers
 in the fiber group, then each node on fiber n is colored based on the
 corresponding row of rgbValues{n}. This means that each cell must have
 the same number of rows as the corresponding fiber in the fiber group.
 For example to color each point on each fiber based on its FA value: 
 vals = dtiGetValFromFibers(dt.dt6,fg,inv(dt.xformToAcpc),'fa');
 rgb = vals2colormap(vals);
 AFQ_RenderFibers(fg,'color',rgb);

 AFQ_RenderFibers(fg,'camera', view) - Render the fiber group and view
 from a specific plane.  The options for view are 'sagittal', 'coronal' or
 'axial'. The default is sagittal. View can also be defined with a 1 by 2
 vector denoting the azimuth (horizontal rotation) and elevation (vertical
 rotation) in degrees of the camera with respect to the fibers. See the
 matlab view function

 AFQ_RenderFibers(fg,'jittershading', jitter) - The darkness of each fiber
 can be randomized slightly to make the fiber group take on more of a 3d
 apearance. jitter defines the standard deviation of how amount of
 randomization in fiber darkness.  The default is jitter = 0.2

 AFQ_RenderFibers(fg,'jittercolor', jitter) - The color of each fiber can
 be randomized slightly to make each individual streamline stand out more.
 jitter defines the amount of randomization for each color channel with
 the mean color defined by 'color' (see above)

 AFQ_RenderFibers(fg,'subdivs',Nsubdivs) - The number of faces to create
 for each fiber node.  For example Nsubdivs = 6 would mean that each
 section of the fiber is hexagonal.  Increase Nsubdivs to make the fibers
 look like tubes. Default is Nsubdivs = 25

 AFQ_RenderFibers(fg,'tubes', [1]) - Whether fibers should be rendered as
 tubes [1] or lines [0]. Lines are faster tubes are prettier. Tubes are
 default

 AFQ_RenderFibers(fg,'newfig', [1]) - Check if rendering should be in new
 window [1] or added to an old window [0]. Default is new figure.

 AFQ_RenderFibers(fg,'numfibers', numfibers) - Only render as many fibers
 as are defined in numfibers. This many fibers will randomly be chosen
 from the fiber group.  This is useful to save time when rendering large
 groups.

 AFQ_RenderFibers(fg,'alpha',alpha) - Set the transparency of the fibers.
 Alpha should be a value between 0 (transparent) and 1 (opaque).

 Example:

 fg = dtiReadFibers('Left_CST.mat');
 dt = dtiLoadDt6('dt6.mat');
 AFQ_RenderFibers(fg, 'dt', dt, 'radius', [.7 5], 'jittercolor', .1);

 Written by Jason D Yeatman, April 2012.

 Copyright Vista Team 2012</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="AFQ_CreateTractProfile.html" class="code" title="function TractProfile = AFQ_CreateTractProfile(varargin)">AFQ_CreateTractProfile</a>	Create the AFQ Tract Profile structure</li><li><a href="AFQ_RenderRoi.html" class="code" title="function h = AFQ_RenderRoi(roi, color, method, render)">AFQ_RenderRoi</a>	Render an ROI as a 3D surface</li><li><a href="AFQ_RenderTractProfile.html" class="code" title="function [lightH] = AFQ_RenderTractProfile(coords, radius, color, subdivs, cmap, crange)">AFQ_RenderTractProfile</a>	Render Tract Profile as a tube colored based on the Tract Profile values</li><li><a href="AFQ_TractProfileGet.html" class="code" title="function val = AFQ_TractProfileGet(TractProfile,param,varargin)">AFQ_TractProfileGet</a>	Get parameters from an afq tract profile</li><li><a href="AFQ_TractProfileSet.html" class="code" title="function TractProfile = AFQ_TractProfileSet(TractProfile,param,varargin)">AFQ_TractProfileSet</a>	Set fields of the afq TractProfile structure</li><li><a href="AFQ_TubeFromCoords.html" class="code" title="function [X Y Z C] = AFQ_TubeFromCoords(coords, r, color, subdivs)">AFQ_TubeFromCoords</a>	Build a mesh of a tube to be rendered with surf.m from a coordinate array</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="AFQ_Segment_PostArcuate.html" class="code" title="function [L_FG R_FG L_roi_2 L_roi_3 R_roi_2 R_roi_3] = AFQ_Segment_PostArcuate(dt, wholebrainFG, sub_dir, varargin)">AFQ_Segment_PostArcuate</a>	Define the posterior segment of the arcuate from a wholebrain fiber group</li><li><a href="AFQ_Segment_VOF.html" class="code" title="function [vofFG vofROI1 vofROI2] = AFQ_Segment_VOF(dt, wholebrainFG, varargin)">AFQ_Segment_VOF</a>	THIS FUNCTION IS STILL BEING DEVELOPED</li><li><a href="AFQ_removeFiberOutliers.html" class="code" title="function [fg keep]=AFQ_removeFiberOutliers(fg,maxDist,maxLen,numNodes,M,count,maxIter,show)">AFQ_removeFiberOutliers</a>	Remove fibers from a fiber group that differ substantially from the</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function lightH = AFQ_RenderFibers(fg,varargin)</a>
0002 <span class="comment">% Render a fiber group and tract profile in 3-D</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   AFQ_RenderFibers(fg,'PropertyName',PropertyValue, ...)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Given an mrDiffusion fiber group structure, AFQ_RenderFibers(fg), will</span>
0007 <span class="comment">% make a 3-D rendering of that fiber group.  The 3-d rendering can be</span>
0008 <span class="comment">% rotated with the keyboard arrow keys There are aditional optional</span>
0009 <span class="comment">% arguments that can be passed into the function.  They are always defined</span>
0010 <span class="comment">% by first entering the 'PropertyName' as a string, followed by the</span>
0011 <span class="comment">% property value which may either be a string, a scaler or a data</span>
0012 <span class="comment">% structure.  Below all the options are described.</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Options:</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% AFQ_RenderFibers(fg,'dt',dtStruct) - If a dt6 structure is provided</span>
0017 <span class="comment">% then the tract FA profile will be rendered along with the fiber group.</span>
0018 <span class="comment">% See dtiLoadDt6 and dtiComputeDiffusionPropertiesAlongFG.</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% AFQ_RenderFibers(fg,'dt',dtStruct,'rois',roi1,roi2) - If a dt6 structure</span>
0021 <span class="comment">% and 2 rois are provided then the tract FA profile will onlyh be rendered</span>
0022 <span class="comment">% for the portion of the tract spanning between the 2 rois.  See</span>
0023 <span class="comment">% dtiReadRois</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% AFQ_RenderFibers(fg,'dt',dtStruct,'crange',range) - 'crange' defines</span>
0026 <span class="comment">% the color range for the tract profile.  The default is range = [0.3 0.6].</span>
0027 <span class="comment">% This means that values below 0.3 will take on the minimum value of the</span>
0028 <span class="comment">% color map and values above 0.6 will take on the maximum value.</span>
0029 <span class="comment">%</span>
0030 <span class="comment">% AFQ_RenderFibers(fg,'dt',dtStruct,'cmap',colormap) - 'cmap' defines the</span>
0031 <span class="comment">% color map to be used for the tract profile.  The default is colormap =</span>
0032 <span class="comment">% 'jet'. Other options are 'autumn' 'hot' 'cool' 'winter' etc. See matlab</span>
0033 <span class="comment">% help for other colormaps</span>
0034 <span class="comment">%</span>
0035 <span class="comment">% AFQ_RenderFibers(fg,'dt',dtStruct,'radius',r) - radius is a 1 by 2 vector</span>
0036 <span class="comment">% that defines the radius of the tubes for the fibers and the tract</span>
0037 <span class="comment">% profile. r(1) is the radius of the fibers and r(2) is the radius of the</span>
0038 <span class="comment">% tract profile. Default is r = [1 5] meaning that fibers have a 1mm radius</span>
0039 <span class="comment">% and the tract profile has a 5mm radius.</span>
0040 <span class="comment">%</span>
0041 <span class="comment">% AFQ_RenderFibers(fg,'tractprofile',TractProfile,'val',['fa']) - A</span>
0042 <span class="comment">% tract profile can be passed in if it has been precomputed for the fiber</span>
0043 <span class="comment">% tract. TractProfile is a structure created by AFQ_CreateTractProfile and</span>
0044 <span class="comment">% contains the coordinates and values to be plotted. The user can also</span>
0045 <span class="comment">% define which value in the tract profile should be plotted. The dafault is</span>
0046 <span class="comment">% 'fa' but the name of any value that exists within the TractProfile</span>
0047 <span class="comment">% structure is ok.</span>
0048 <span class="comment">%</span>
0049 <span class="comment">% AFQ_RenderFibers(fg,'color', rgbValues) - Render the fiber group in a</span>
0050 <span class="comment">% specific color.  rgbValues can be defined in 3 ways to do (1) uniform</span>
0051 <span class="comment">% coloring for the fiber group, (2) fiberwise coloring or (3) pointwise</span>
0052 <span class="comment">% coloring.</span>
0053 <span class="comment">% (1) If rgbValues is a 1 x 3 vector of rgb values than each fiber is</span>
0054 <span class="comment">% colored that same color. The default color is gray [0.7 0.7 0.7]. To do</span>
0055 <span class="comment">% cyan for example rgbValues = [0 1 1].</span>
0056 <span class="comment">% (2) If rgbValues is a N x 3 vector where N is the number of fibers in</span>
0057 <span class="comment">% the fiber group, then each fiber in the group is rendered in its own</span>
0058 <span class="comment">% color. Each fiber's color is defined by the coresponding row of</span>
0059 <span class="comment">% rgbValues. For example to color each fiber a random color:</span>
0060 <span class="comment">% rgbValues=rand(length(fg.fibers),3)</span>
0061 <span class="comment">% (3) If rgbValues is a 1 x N cell array where N is the number of fibers</span>
0062 <span class="comment">% in the fiber group, then each node on fiber n is colored based on the</span>
0063 <span class="comment">% corresponding row of rgbValues{n}. This means that each cell must have</span>
0064 <span class="comment">% the same number of rows as the corresponding fiber in the fiber group.</span>
0065 <span class="comment">% For example to color each point on each fiber based on its FA value:</span>
0066 <span class="comment">% vals = dtiGetValFromFibers(dt.dt6,fg,inv(dt.xformToAcpc),'fa');</span>
0067 <span class="comment">% rgb = vals2colormap(vals);</span>
0068 <span class="comment">% AFQ_RenderFibers(fg,'color',rgb);</span>
0069 <span class="comment">%</span>
0070 <span class="comment">% AFQ_RenderFibers(fg,'camera', view) - Render the fiber group and view</span>
0071 <span class="comment">% from a specific plane.  The options for view are 'sagittal', 'coronal' or</span>
0072 <span class="comment">% 'axial'. The default is sagittal. View can also be defined with a 1 by 2</span>
0073 <span class="comment">% vector denoting the azimuth (horizontal rotation) and elevation (vertical</span>
0074 <span class="comment">% rotation) in degrees of the camera with respect to the fibers. See the</span>
0075 <span class="comment">% matlab view function</span>
0076 <span class="comment">%</span>
0077 <span class="comment">% AFQ_RenderFibers(fg,'jittershading', jitter) - The darkness of each fiber</span>
0078 <span class="comment">% can be randomized slightly to make the fiber group take on more of a 3d</span>
0079 <span class="comment">% apearance. jitter defines the standard deviation of how amount of</span>
0080 <span class="comment">% randomization in fiber darkness.  The default is jitter = 0.2</span>
0081 <span class="comment">%</span>
0082 <span class="comment">% AFQ_RenderFibers(fg,'jittercolor', jitter) - The color of each fiber can</span>
0083 <span class="comment">% be randomized slightly to make each individual streamline stand out more.</span>
0084 <span class="comment">% jitter defines the amount of randomization for each color channel with</span>
0085 <span class="comment">% the mean color defined by 'color' (see above)</span>
0086 <span class="comment">%</span>
0087 <span class="comment">% AFQ_RenderFibers(fg,'subdivs',Nsubdivs) - The number of faces to create</span>
0088 <span class="comment">% for each fiber node.  For example Nsubdivs = 6 would mean that each</span>
0089 <span class="comment">% section of the fiber is hexagonal.  Increase Nsubdivs to make the fibers</span>
0090 <span class="comment">% look like tubes. Default is Nsubdivs = 25</span>
0091 <span class="comment">%</span>
0092 <span class="comment">% AFQ_RenderFibers(fg,'tubes', [1]) - Whether fibers should be rendered as</span>
0093 <span class="comment">% tubes [1] or lines [0]. Lines are faster tubes are prettier. Tubes are</span>
0094 <span class="comment">% default</span>
0095 <span class="comment">%</span>
0096 <span class="comment">% AFQ_RenderFibers(fg,'newfig', [1]) - Check if rendering should be in new</span>
0097 <span class="comment">% window [1] or added to an old window [0]. Default is new figure.</span>
0098 <span class="comment">%</span>
0099 <span class="comment">% AFQ_RenderFibers(fg,'numfibers', numfibers) - Only render as many fibers</span>
0100 <span class="comment">% as are defined in numfibers. This many fibers will randomly be chosen</span>
0101 <span class="comment">% from the fiber group.  This is useful to save time when rendering large</span>
0102 <span class="comment">% groups.</span>
0103 <span class="comment">%</span>
0104 <span class="comment">% AFQ_RenderFibers(fg,'alpha',alpha) - Set the transparency of the fibers.</span>
0105 <span class="comment">% Alpha should be a value between 0 (transparent) and 1 (opaque).</span>
0106 <span class="comment">%</span>
0107 <span class="comment">% Example:</span>
0108 <span class="comment">%</span>
0109 <span class="comment">% fg = dtiReadFibers('Left_CST.mat');</span>
0110 <span class="comment">% dt = dtiLoadDt6('dt6.mat');</span>
0111 <span class="comment">% AFQ_RenderFibers(fg, 'dt', dt, 'radius', [.7 5], 'jittercolor', .1);</span>
0112 <span class="comment">%</span>
0113 <span class="comment">% Written by Jason D Yeatman, April 2012.</span>
0114 <span class="comment">%</span>
0115 <span class="comment">% Copyright Vista Team 2012</span>
0116 
0117 <span class="comment">%% Argument checking</span>
0118 
0119 <span class="comment">% Check to make sure the fiber group isn't empty</span>
0120 <span class="keyword">if</span> isempty(fg.fibers) || length(fg.fibers) == 0
0121     fprintf(<span class="string">'Fiber group is empty\n'</span>);
0122     <span class="keyword">return</span>
0123 <span class="keyword">end</span>
0124 <span class="comment">% Check if a dt6 file was input</span>
0125 <span class="keyword">if</span> sum(strcmpi(<span class="string">'dt'</span>,varargin)) &gt; 0
0126     dt = varargin{find(strcmpi(<span class="string">'dt'</span>,varargin))+1};
0127 <span class="keyword">else</span>
0128     dt = [];
0129 <span class="keyword">end</span>
0130 
0131 <span class="comment">% Check if rois were input.  There should be 2 rois after the argument rois</span>
0132 <span class="keyword">if</span> sum(strcmpi(<span class="string">'rois'</span>,varargin)) &gt; 0
0133     roi1 = varargin{find(strcmpi(<span class="string">'rois'</span>,varargin))+1};
0134     roi2 = varargin{find(strcmpi(<span class="string">'rois'</span>,varargin))+2};
0135     <span class="comment">% Check if the rois are the propper format.  If not, do not use them</span>
0136     <span class="keyword">if</span> ~isstruct(roi1)
0137         warning(<span class="string">'roi1 is not the propper format'</span>)
0138         roi1 = [];
0139         roi2 = [];
0140     <span class="keyword">elseif</span> ~isstruct(roi2)
0141         warning(<span class="string">'roi2 is not the propper format'</span>)
0142         roi1 = [];
0143         roi2 = [];
0144     <span class="keyword">end</span>
0145 <span class="keyword">else</span>
0146     roi1 = [];
0147     roi2 = [];
0148 <span class="keyword">end</span>
0149 
0150 <span class="comment">% check if the camera angle is defined</span>
0151 <span class="keyword">if</span> sum(strcmpi(<span class="string">'camera'</span>,varargin)) &gt; 0
0152     camera = varargin{find(strcmpi(<span class="string">'camera'</span>,varargin))+1};
0153     <span class="keyword">if</span> ischar(camera)
0154         <span class="keyword">switch</span>(camera)
0155             <span class="keyword">case</span> <span class="string">'sagittal'</span>
0156                 camera = [270 0];
0157                 lightPosition = [-60 0 0];
0158             <span class="keyword">case</span> <span class="string">'axial'</span>
0159                 camera = [0 90];
0160                 lightPosition = [-10 10 80];
0161             <span class="keyword">case</span> <span class="string">'coronal'</span>
0162                 camera = [0 0];
0163                 lightPosition = [-60 0 0];
0164             <span class="keyword">case</span> <span class="string">'uncinate'</span>
0165                 camera = [-85 40];
0166                 lightPosition = [0 0 -100];
0167             <span class="keyword">case</span> <span class="string">'ifof'</span>
0168                 camera = [280 10];
0169                 lightPosition = [-60 -10 -20];
0170             <span class="keyword">case</span> <span class="string">'callosum'</span>
0171                 camera = [180 90];
0172                 lightPosition = [60 0 0];
0173         <span class="keyword">end</span>
0174     <span class="keyword">else</span>
0175         <span class="comment">% default light position</span>
0176         lightPosition = [-60 0 0];
0177     <span class="keyword">end</span>
0178 <span class="keyword">else</span>
0179     camera = [270 0]; <span class="comment">%default camera angle is looking at the sagital plane</span>
0180     lightPosition = [-60 0 0];
0181 <span class="keyword">end</span>
0182 
0183 <span class="comment">% if color is not defined use gray</span>
0184 <span class="keyword">if</span> sum(strcmpi(<span class="string">'color'</span>,varargin)) &gt; 0
0185     color = varargin{find(strcmpi(<span class="string">'color'</span>,varargin))+1};
0186 <span class="keyword">else</span>
0187     color = [0.7 0.7 0.7]; <span class="comment">%default color for fiber group is gray</span>
0188 <span class="keyword">end</span>
0189 
0190 <span class="comment">% To make each fiber stand out more we can jitter the darkness of each</span>
0191 <span class="comment">% fiber. The amount of change in darkness is randomly sampled from a</span>
0192 <span class="comment">% uniform distributions with range = -js to js.</span>
0193 <span class="keyword">if</span> sum(strcmpi(<span class="string">'jittershading'</span>,varargin)) &gt; 0
0194     js = varargin{find(strcmpi(<span class="string">'jittershading'</span>,varargin))+1};
0195 <span class="keyword">else</span>
0196     js = .2; <span class="comment">%default amount of jitter in the coloring</span>
0197 <span class="keyword">end</span>
0198 
0199 <span class="comment">% To make each fiber stand out more we can jitter the color of each fiber.</span>
0200 <span class="comment">% The amount of change in color is randomly sampled from a uniform</span>
0201 <span class="comment">% distributions with range = -jf to jf.</span>
0202 <span class="keyword">if</span> sum(strcmpi(<span class="string">'jittercolor'</span>,varargin)) &gt; 0
0203     jf = varargin{find(strcmpi(<span class="string">'jittercolor'</span>,varargin))+1};
0204 <span class="keyword">else</span>
0205     jf = 0; <span class="comment">%default amount of jitter in the coloring</span>
0206 <span class="keyword">end</span>
0207 
0208 <span class="comment">% Number of subdivisions per fiber node</span>
0209 <span class="keyword">if</span> sum(strcmpi(<span class="string">'subdivs'</span>,varargin)) &gt; 0
0210     subdivs = varargin{find(strcmpi(<span class="string">'subdivs'</span>,varargin))+1};
0211 <span class="keyword">else</span>
0212     subdivs = 20;
0213 <span class="keyword">end</span>
0214 
0215 <span class="comment">% color range for tract profile</span>
0216 <span class="keyword">if</span> sum(strcmpi(<span class="string">'crange'</span>,varargin)) &gt; 0
0217     crange = varargin{find(strcmpi(<span class="string">'crange'</span>,varargin))+1};
0218 <span class="keyword">else</span>
0219     crange = [.3 .6]; <span class="comment">%default color range</span>
0220 <span class="keyword">end</span>
0221 
0222 <span class="comment">% color map for tract profile</span>
0223 <span class="keyword">if</span> sum(strcmpi(<span class="string">'cmap'</span>,varargin)) &gt; 0
0224     cmap = varargin{find(strcmpi(<span class="string">'cmap'</span>,varargin))+1};
0225 <span class="keyword">else</span>
0226     cmap = <span class="string">'jet'</span>; <span class="comment">%default color map</span>
0227 <span class="keyword">end</span>
0228 
0229 <span class="comment">% If a tract proflie is provided use it.  Otherwise if a dt6 file is input</span>
0230 <span class="comment">% then compute the tract profile.  If neither is provided then do nothing.</span>
0231 <span class="keyword">if</span> sum(strcmpi(<span class="string">'tractprofile'</span>,varargin)) &gt; 0
0232     TP = varargin{find(strcmpi(<span class="string">'tractprofile'</span>,varargin))+1};
0233     computeTP = false;
0234 <span class="keyword">elseif</span> exist(<span class="string">'dt'</span>,<span class="string">'var'</span>) &amp;&amp; ~isempty(dt)
0235     computeTP = true;
0236     TP = [];
0237 <span class="keyword">else</span>
0238     TP = [];
0239     computeTP = false;
0240 <span class="keyword">end</span>
0241 
0242 <span class="comment">% Check what value should be plotted on the tract profile</span>
0243 <span class="keyword">if</span> sum(strcmpi(<span class="string">'val'</span>,varargin)) &gt; 0
0244     valname = varargin{find(strcmpi(<span class="string">'val'</span>,varargin))+1};
0245 <span class="keyword">else</span>
0246     valname = <span class="string">'fa'</span>;
0247 <span class="keyword">end</span>
0248 <span class="comment">% Check if the user has defined a radius for the fiber tubes and for the</span>
0249 <span class="comment">% tract profile.  Within the radius variable the first number is for the</span>
0250 <span class="comment">% fibers and the second number is for the tract profile.</span>
0251 <span class="keyword">if</span> sum(strcmpi(<span class="string">'radius'</span>,varargin)) &gt; 0
0252     rFib = varargin{find(strcmpi(<span class="string">'radius'</span>,varargin))+1};
0253     <span class="keyword">if</span> length(rFib)==2
0254         rTP = rFib(2);
0255         rFib   = rFib(1);
0256     <span class="keyword">else</span>
0257         <span class="comment">% Set the radius of the tract profile to the default if the user</span>
0258         <span class="comment">% only set the radius of the fibers</span>
0259         rTP = 5;
0260     <span class="keyword">end</span>
0261 <span class="keyword">else</span>
0262     rFib = 1;
0263     rTP = 5;
0264 <span class="keyword">end</span>
0265 
0266 <span class="comment">% Check if fibers should be rendered as tubes or plotted as lines</span>
0267 <span class="keyword">if</span> sum(strcmpi(<span class="string">'tubes'</span>,varargin)) &gt; 0
0268     tubes = varargin{find(strcmpi(<span class="string">'tubes'</span>,varargin))+1};
0269 <span class="keyword">else</span>
0270     <span class="comment">% default is tubes</span>
0271     tubes = true;
0272 <span class="keyword">end</span>
0273 
0274 <span class="comment">% Check if rendering should be in new window or added to an old window</span>
0275 <span class="keyword">if</span> sum(strcmpi(<span class="string">'newfig'</span>,varargin)) &gt; 0
0276     newfig = varargin{find(strcmpi(<span class="string">'newfig'</span>,varargin))+1};
0277 <span class="keyword">else</span>
0278     <span class="comment">% default is to render in a new figure window</span>
0279     newfig = 1;
0280 <span class="keyword">end</span>
0281 
0282 <span class="comment">% Randomly choose the desired number of fibers to be rendered.</span>
0283 <span class="keyword">if</span> sum(strcmpi(<span class="string">'numfibers'</span>,varargin)) &gt; 0
0284     numfib = varargin{find(strcmpi(<span class="string">'numfibers'</span>,varargin))+1};
0285     <span class="comment">% check if there are more fibers than the number specified</span>
0286     <span class="keyword">if</span> length(fg.fibers) &gt; numfib
0287         <span class="comment">% generate a random index of fibers</span>
0288         fibindx = randsample(length(fg.fibers),numfib);
0289         <span class="comment">% retain only these fibers for the rendering</span>
0290         fg.fibers = fg.fibers(fibindx);
0291         <span class="comment">% if there fiber specific coloring was defined make sure to retain</span>
0292         <span class="comment">% the correct color values</span>
0293         <span class="keyword">if</span> iscell(color)
0294             color = color(fibindx);
0295         <span class="keyword">elseif</span> size(color,1) &gt; 1
0296             color = color(fibindx,:);
0297         <span class="keyword">end</span>
0298     <span class="keyword">end</span>
0299 <span class="keyword">end</span>
0300 
0301 <span class="comment">% Set the transparency of the fibers</span>
0302 <span class="keyword">if</span> sum(strcmpi(<span class="string">'alpha'</span>,varargin)) &gt; 0
0303     alpha = varargin{find(strcmpi(<span class="string">'alpha'</span>,varargin))+1};
0304 <span class="keyword">else</span>
0305     alpha = 1;
0306 <span class="keyword">end</span>
0307 <span class="comment">%% Loop over fibers and render them in 3-D</span>
0308 
0309 <span class="comment">% Only render in a new figure window if desired (default)</span>
0310 <span class="keyword">if</span> newfig == 1
0311     figure; hold(<span class="string">'on'</span>);
0312 <span class="keyword">end</span>
0313 
0314 <span class="comment">% Render each fiber as a tube (slow) if the parameter tubes == 1</span>
0315 <span class="keyword">if</span> tubes == 1
0316     <span class="keyword">for</span> ii = 1:length(fg.fibers)
0317         
0318         <span class="comment">% X, Y and Z coordinates for the fiber</span>
0319         coords = fg.fibers{ii};
0320         
0321         <span class="comment">% Build the mesh of the fiber. The coloring of the mesh will depend</span>
0322         <span class="comment">% on whether color was defined for the full fiber group, for each</span>
0323         <span class="comment">% fiber, or for each point on each fiber</span>
0324         <span class="keyword">if</span> size(color,1) == 1 &amp;&amp; size(color,2) == 3
0325             <span class="comment">% If 1 color was defined than use that color for each fiber</span>
0326             [X Y Z C] = <a href="AFQ_TubeFromCoords.html" class="code" title="function [X Y Z C] = AFQ_TubeFromCoords(coords, r, color, subdivs)">AFQ_TubeFromCoords</a>(coords, rFib, color, subdivs);
0327         <span class="keyword">elseif</span> size(color,1) == length(fg.fibers) &amp;&amp; size(color,2) == 3
0328             <span class="comment">% If color is a N x 3 array with a different color defined for</span>
0329             <span class="comment">% each fiber than color fg.fibers{ii} the color defined by</span>
0330             <span class="comment">% color(ii,:)</span>
0331             fColor = color(ii,:);
0332             [X Y Z C] = <a href="AFQ_TubeFromCoords.html" class="code" title="function [X Y Z C] = AFQ_TubeFromCoords(coords, r, color, subdivs)">AFQ_TubeFromCoords</a>(coords, rFib, fColor, subdivs);
0333         <span class="keyword">elseif</span> iscell(color) &amp;&amp; length(color) == length(fg.fibers)
0334             <span class="comment">% If color is a cell array where each cell contains a color for</span>
0335             <span class="comment">% each point on the fiber than color each node fg.fibers{ii}</span>
0336             <span class="comment">% the colors defined in color{ii}</span>
0337             fColor = color{ii};
0338             [X Y Z C] = <a href="AFQ_TubeFromCoords.html" class="code" title="function [X Y Z C] = AFQ_TubeFromCoords(coords, r, color, subdivs)">AFQ_TubeFromCoords</a>(coords, rFib, fColor, subdivs);
0339         <span class="keyword">end</span>
0340         
0341         <span class="comment">% Add some random jitter to the shading so some fibers are slightly</span>
0342         <span class="comment">% lighter or darker</span>
0343         C = C+[rand(1).*2 - 1].*js;
0344         <span class="comment">% to jitter based on a Gaussian distribution</span>
0345         <span class="comment">% C = C+randn(1).*js;</span>
0346         
0347         <span class="comment">% Make sure that after adding the jitter the colors don't exceed the</span>
0348         <span class="comment">% range of 0 to 1</span>
0349         C(C &gt; 1) = 1;
0350         C(C &lt; 0) = 0;
0351         
0352         <span class="comment">% Add some random jitter to the fiber color.</span>
0353         <span class="comment">% jitter red channel</span>
0354         C(:,:,1) = C(:,:,1)+[rand(1).*2 - 1].*jf;
0355         <span class="comment">% jitter green channel</span>
0356         C(:,:,2) = C(:,:,2)+[rand(1).*2 - 1].*jf;
0357         <span class="comment">% jitter blue channel</span>
0358         C(:,:,3) = C(:,:,3)+[rand(1).*2 - 1].*jf;
0359         <span class="comment">% Make sure that after adding the jitter the colors don't exceed the</span>
0360         <span class="comment">% range of 0 to 1</span>
0361         C(C &gt; 1) = 1;
0362         C(C &lt; 0) = 0;
0363         
0364         <span class="comment">% Render fiber tubes</span>
0365         surf(X,Y,Z,C,<span class="string">'facealpha'</span>,alpha);
0366     <span class="keyword">end</span>
0367     
0368     <span class="comment">% Plot the fibers as lines (much faster than tubes) if the input tubes == 0</span>
0369 <span class="keyword">else</span>
0370     <span class="keyword">for</span> ii = 1:length(fg.fibers)
0371         <span class="comment">% X, Y and Z coordinates for the fiber</span>
0372         x = fg.fibers{ii}(1,:)';
0373         y = fg.fibers{ii}(2,:)';
0374         z = fg.fibers{ii}(3,:)';
0375         <span class="comment">% Jitter color and shading</span>
0376         C = color + [rand(1,3).*2 - 1].*jf+[rand(1).*2 - 1].*js;
0377         <span class="comment">% Make sure that after adding the jitter the colors don't exceed the</span>
0378         <span class="comment">% range of 0 to 1</span>
0379         C(C &gt; 1) = 1;
0380         C(C &lt; 0) = 0;
0381         <span class="comment">% plot the fibers as lines</span>
0382         plot3(x,y,z,<span class="string">'-'</span>,<span class="string">'color'</span>,C);
0383     <span class="keyword">end</span>
0384 <span class="keyword">end</span>
0385 
0386 <span class="comment">%% Render the tract profile</span>
0387 <span class="keyword">if</span> computeTP
0388     <span class="comment">% compute tract profile</span>
0389     [fa,md,rd,ad,cl,fgCore]=dtiComputeDiffusionPropertiesAlongFG(fg, dt, roi1, roi2, 100);
0390     <span class="comment">% Create Tract Profile structure</span>
0391     TP = <a href="AFQ_CreateTractProfile.html" class="code" title="function TractProfile = AFQ_CreateTractProfile(varargin)">AFQ_CreateTractProfile</a>;
0392     <span class="comment">% Set the desired values to the structure</span>
0393     TP = <a href="AFQ_TractProfileSet.html" class="code" title="function TractProfile = AFQ_TractProfileSet(TractProfile,param,varargin)">AFQ_TractProfileSet</a>(TP,<span class="string">'vals'</span>,valname,eval(valname));
0394     <span class="comment">% Set the tract profile coordinates</span>
0395     TP = <a href="AFQ_TractProfileSet.html" class="code" title="function TractProfile = AFQ_TractProfileSet(TractProfile,param,varargin)">AFQ_TractProfileSet</a>(TP,<span class="string">'coordsacpc'</span>,fgCore.fibers{1});
0396 <span class="keyword">end</span>
0397 <span class="keyword">if</span> exist(<span class="string">'TP'</span>,<span class="string">'var'</span>) &amp;&amp; ~isempty(TP)
0398     <span class="comment">% Get the coordinates</span>
0399     coords = <a href="AFQ_TractProfileGet.html" class="code" title="function val = AFQ_TractProfileGet(TractProfile,param,varargin)">AFQ_TractProfileGet</a>(TP,<span class="string">'coordsacpc'</span>);
0400     <span class="comment">% Get the values</span>
0401     vals = <a href="AFQ_TractProfileGet.html" class="code" title="function val = AFQ_TractProfileGet(TractProfile,param,varargin)">AFQ_TractProfileGet</a>(TP,<span class="string">'vals'</span>,valname);
0402     <span class="comment">% Render the tract Profile</span>
0403     <a href="AFQ_RenderTractProfile.html" class="code" title="function [lightH] = AFQ_RenderTractProfile(coords, radius, color, subdivs, cmap, crange)">AFQ_RenderTractProfile</a>(coords,rTP,vals,30,cmap,crange);
0404 <span class="keyword">end</span>
0405 
0406 <span class="comment">% Render the ROIs if they were passed in</span>
0407 <span class="keyword">if</span> exist(<span class="string">'roi1'</span>,<span class="string">'var'</span>)&amp;&amp;exist(<span class="string">'roi2'</span>,<span class="string">'var'</span>)&amp;&amp;~isempty(roi1)&amp;&amp;~isempty(roi2)
0408     <a href="AFQ_RenderRoi.html" class="code" title="function h = AFQ_RenderRoi(roi, color, method, render)">AFQ_RenderRoi</a>(roi1,[1 0 0]);
0409     <a href="AFQ_RenderRoi.html" class="code" title="function h = AFQ_RenderRoi(roi, color, method, render)">AFQ_RenderRoi</a>(roi2,[1 0 0]);
0410 <span class="keyword">end</span>
0411 <span class="comment">%% Set the lighting, axes, etc.</span>
0412 
0413 shading(<span class="string">'interp'</span>);
0414 <span class="comment">% Only set window properties if the fibers were rendered in a new figure</span>
0415 <span class="comment">% window</span>
0416 <span class="keyword">if</span> newfig ==1
0417     coordsAll = horzcat(fg.fibers{:});
0418     mx = minmax(coordsAll(1,:));
0419     my = minmax(coordsAll(2,:));
0420     mz = minmax(coordsAll(3,:));
0421     axis([mx(1)-3 mx(2)+3 my(1)-3 my(2)+3 mz(1)-3 mz(2)+3],<span class="string">'equal'</span>);
0422     xlabel(<span class="string">'X mm'</span>,<span class="string">'fontname'</span>,<span class="string">'times'</span>,<span class="string">'fontsize'</span>,14);
0423     ylabel(<span class="string">'Y mm'</span>,<span class="string">'fontname'</span>,<span class="string">'times'</span>,<span class="string">'fontsize'</span>,14);
0424     zlabel(<span class="string">'Z mm'</span>,<span class="string">'fontname'</span>,<span class="string">'times'</span>,<span class="string">'fontsize'</span>,14);
0425     set(gca,<span class="string">'fontname'</span>,<span class="string">'times'</span>,<span class="string">'fontsize'</span>,14);
0426     set(gcf,<span class="string">'color'</span>,[1 1 1]);
0427     grid(<span class="string">'on'</span>);
0428     <span class="keyword">if</span> size(camera,2) == 2
0429         view(camera(1), camera(2));
0430     <span class="keyword">elseif</span> size(camera,2) == 3
0431         campos(camera);
0432     <span class="keyword">end</span>
0433     lightH = camlight;
0434     set(lightH, <span class="string">'position'</span>,lightPosition);
0435     lighting(<span class="string">'gouraud'</span>);
0436     cameratoolbar(<span class="string">'Show'</span>);
0437     cameratoolbar(<span class="string">'SetMode'</span>,<span class="string">'orbit'</span>);
0438     fprintf(<span class="string">'\nmesh can be rotated with arrow keys\n'</span>)
0439 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 14-Nov-2012 17:12:08 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>