<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of AFQ_plot</title>
  <meta name="keywords" content="AFQ_plot">
  <meta name="description" content="This function will plot AFQ results in a variety of ways">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">functions</a> &gt; AFQ_plot.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for functions&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>AFQ_plot
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This function will plot AFQ results in a variety of ways</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function AFQ_plot(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> This function will plot AFQ results in a variety of ways

 AFQ_plot(varargin)

 Plotting options are described below:

 --Group Plots--

 AFQ_plot(afq , 'group')
 or
 AFQ_plot('group1 name', data1, 'group2 name', data2, 'group')
 
 Tract diffusion profiles can be plotted for multiple groups of subjects.
 For each of the 20 tracts the group mean +/- 1 standard error of the mean
 is plotted.  Each group is on the same plot in a different color. The
 propper input to the function is 'group name' as a string followed
 by data which is the structured array of tract diffusion profiles output from
 AFQ_run.  The string 'group' at the end defines that you would like
 a group plot as oppose to one of the other plotting options.
 
 Examples:
 [patient_data control_data]=AFQ_run(sub_dirs, sub_group);
 AFQ_plot('patient',patient_data,'control',control_data, 'group');
 Options:
 To plot the data only for a subset of the tracts pass in the 'tracts'
 argument followed by a vector of tract numbers to plot
 AFQ_plot('patient',patient_data,'control',control_data,'tracts',[1,2,6],'group');

 --Individual Subject Plots--
 
 AFQ_plot(afq,'individual')
 or
 AFQ_plot(norms, patient_data, 'ci',[10 90], 'legend',subnames, 'individual')

 Tract diffusion profiles will be plotted for each patient with respect to
 the control group norms. The 'ci' argument is optional.  This will define
 the width of the outer confidence interval in percentiles to plot for the
 nomrs.  If this argument is not passed in default values of 10th and 90th
 percentiles will be used. The 'legend' argument is also optional and will
 allow a cell array of subject names to be passed in and these will be
 added to a legend on each plot. 

 Examples:
 [patient_data control_data]=AFQ_run(sub_dirs, sub_group);
 subnames = {'Sub 1' 'Sub 2' 'Sub 3' 'Sub 4'};
 AFQ_plot(norms,patient_data,'ci',[10 90], 'legend',subnames,'individual');

 Copyright Jason D. Yeatman Stanford Vista Team 2011</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>	Get value from afq structure</li><li><a href="../utilities/isafq.html" class="code" title="function log = isafq(afq)">isafq</a>	Check if a variable is an afq structure</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="AFQ_run.html" class="code" title="function [afq patient_data control_data norms abn abnTracts] = AFQ_run(sub_dirs, sub_group, afq)">AFQ_run</a>	Run AFQ analysis on a set of subjects to generate Tract Profiles of white</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function AFQ_plot(varargin)</a>
0002 <span class="comment">% This function will plot AFQ results in a variety of ways</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% AFQ_plot(varargin)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Plotting options are described below:</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% --Group Plots--</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% AFQ_plot(afq , 'group')</span>
0011 <span class="comment">% or</span>
0012 <span class="comment">% AFQ_plot('group1 name', data1, 'group2 name', data2, 'group')</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Tract diffusion profiles can be plotted for multiple groups of subjects.</span>
0015 <span class="comment">% For each of the 20 tracts the group mean +/- 1 standard error of the mean</span>
0016 <span class="comment">% is plotted.  Each group is on the same plot in a different color. The</span>
0017 <span class="comment">% propper input to the function is 'group name' as a string followed</span>
0018 <span class="comment">% by data which is the structured array of tract diffusion profiles output from</span>
0019 <span class="comment">% AFQ_run.  The string 'group' at the end defines that you would like</span>
0020 <span class="comment">% a group plot as oppose to one of the other plotting options.</span>
0021 <span class="comment">%</span>
0022 <span class="comment">% Examples:</span>
0023 <span class="comment">% [patient_data control_data]=AFQ_run(sub_dirs, sub_group);</span>
0024 <span class="comment">% AFQ_plot('patient',patient_data,'control',control_data, 'group');</span>
0025 <span class="comment">% Options:</span>
0026 <span class="comment">% To plot the data only for a subset of the tracts pass in the 'tracts'</span>
0027 <span class="comment">% argument followed by a vector of tract numbers to plot</span>
0028 <span class="comment">% AFQ_plot('patient',patient_data,'control',control_data,'tracts',[1,2,6],'group');</span>
0029 <span class="comment">%</span>
0030 <span class="comment">% --Individual Subject Plots--</span>
0031 <span class="comment">%</span>
0032 <span class="comment">% AFQ_plot(afq,'individual')</span>
0033 <span class="comment">% or</span>
0034 <span class="comment">% AFQ_plot(norms, patient_data, 'ci',[10 90], 'legend',subnames, 'individual')</span>
0035 <span class="comment">%</span>
0036 <span class="comment">% Tract diffusion profiles will be plotted for each patient with respect to</span>
0037 <span class="comment">% the control group norms. The 'ci' argument is optional.  This will define</span>
0038 <span class="comment">% the width of the outer confidence interval in percentiles to plot for the</span>
0039 <span class="comment">% nomrs.  If this argument is not passed in default values of 10th and 90th</span>
0040 <span class="comment">% percentiles will be used. The 'legend' argument is also optional and will</span>
0041 <span class="comment">% allow a cell array of subject names to be passed in and these will be</span>
0042 <span class="comment">% added to a legend on each plot.</span>
0043 <span class="comment">%</span>
0044 <span class="comment">% Examples:</span>
0045 <span class="comment">% [patient_data control_data]=AFQ_run(sub_dirs, sub_group);</span>
0046 <span class="comment">% subnames = {'Sub 1' 'Sub 2' 'Sub 3' 'Sub 4'};</span>
0047 <span class="comment">% AFQ_plot(norms,patient_data,'ci',[10 90], 'legend',subnames,'individual');</span>
0048 <span class="comment">%</span>
0049 <span class="comment">% Copyright Jason D. Yeatman Stanford Vista Team 2011</span>
0050 
0051 <span class="comment">%% Argument checks and data formatting</span>
0052 
0053 <span class="comment">% Check if the first argument is an afq structure. If so we will get the</span>
0054 <span class="comment">% data from that.</span>
0055 <span class="keyword">if</span> <a href="../utilities/isafq.html" class="code" title="function log = isafq(afq)">isafq</a>(varargin{1})
0056     afq = varargin{1};
0057     <span class="comment">% Get the proper data from the afq structure depending on the plotting</span>
0058     <span class="comment">% arguments</span>
0059     <span class="keyword">if</span> sum(strcmpi(<span class="string">'group'</span>,varargin))
0060         data{1} = <a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'control_data'</span>);
0061         data{2} = <a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'patient_data'</span>);
0062         gnames = {<span class="string">'control'</span>, <span class="string">'patient'</span>};
0063     <span class="keyword">elseif</span> sum(strcmpi(<span class="string">'individual'</span>,varargin))
0064         data{1} = <a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'norms'</span>);
0065         data{2} = <a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'patient_data'</span>);
0066     <span class="keyword">elseif</span> sum(strcmpi(<span class="string">'colormap'</span>,varargin)) &gt; 0
0067         data{1} = <a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'control_data'</span>);   
0068     <span class="keyword">end</span>
0069 <span class="keyword">end</span>
0070 
0071 <span class="comment">% Divide up the inputs into data and arguments. This is done by looping</span>
0072 <span class="comment">% over the number of input arguments and checking if they are structures or</span>
0073 <span class="comment">% strings</span>
0074 argnum = 0; datanum = 0;
0075 <span class="keyword">for</span> ii = 1 : nargin
0076     <span class="keyword">if</span> ischar(varargin{ii})
0077         argnum        = argnum + 1;
0078         arg{argnum}   = varargin{ii};
0079     <span class="keyword">elseif</span> isstruct(varargin{ii}) &amp;&amp; ~<a href="../utilities/isafq.html" class="code" title="function log = isafq(afq)">isafq</a>(varargin{ii})
0080         datanum       = datanum + 1;
0081         data{datanum} = varargin{ii};
0082     <span class="keyword">end</span>
0083 <span class="keyword">end</span>
0084 
0085 <span class="comment">% check if figures should be saved</span>
0086 s = strcmpi(<span class="string">'savefigs'</span>, varargin);
0087 <span class="keyword">if</span> sum(s) &gt; 0
0088     outdir = varargin{find(s)+1};
0089     savefigs = 1;
0090 <span class="keyword">else</span>
0091     savefigs = 0;
0092 <span class="keyword">end</span>
0093 
0094 <span class="comment">% Check if the user specified a subset of tracts to plot otherwise plot all</span>
0095 <span class="comment">% of them</span>
0096 t = strcmpi(<span class="string">'tracts'</span>, varargin);
0097 <span class="keyword">if</span> sum(t) &gt; 0
0098     tracts = varargin{find(t)+1};
0099 <span class="keyword">elseif</span> sum(strcmpi(<span class="string">'colormap'</span>,arg)) &gt; 0
0100     <span class="comment">% For 'colormap' plots the tract data will be in data{1}</span>
0101     tracts = 1:length(data{1});
0102 <span class="keyword">elseif</span> sum(strcmpi(<span class="string">'group'</span>,arg)) &gt; 0 || sum(strcmpi(<span class="string">'individual'</span>,arg)) &gt; 0;
0103     <span class="comment">% For 'group' and 'individual' plots the tract data will be in data{2}</span>
0104     tracts = 1:length(data{2});
0105 <span class="keyword">end</span>
0106 <span class="comment">% tracts should be a row vector</span>
0107 <span class="keyword">if</span> size(tracts,2) &lt; size(tracts,1)
0108     tracts = tracts';
0109 <span class="keyword">end</span>
0110 
0111 <span class="comment">% Check if there is a defined property to plot</span>
0112 p = strcmpi(<span class="string">'property'</span>, varargin);
0113 <span class="keyword">if</span> sum(p) &gt; 0
0114     property = lower(varargin{find(p)+1});
0115 <span class="keyword">else</span>
0116     <span class="comment">% default property to plot</span>
0117     property = <span class="string">'fa'</span>;
0118 <span class="keyword">end</span>
0119 
0120 <span class="comment">% Check if there are defined subjects to plot otherwise plot all subjects</span>
0121 s = strcmpi(<span class="string">'subjects'</span>, varargin);
0122 <span class="keyword">if</span> sum(s) &gt; 0
0123     <span class="comment">% For 'colormap' plots the tract data will be in data{1}</span>
0124     subjects = varargin{find(s)+1};
0125 <span class="keyword">elseif</span> sum(strcmpi(<span class="string">'colormap'</span>,arg)) &gt; 0
0126     subjects = 1:length(data{1}(1).FA(:,1));
0127 <span class="keyword">elseif</span> sum(strcmpi(<span class="string">'group'</span>,arg)) &gt; 0 || sum(strcmpi(<span class="string">'individual'</span>,arg)) &gt; 0;
0128     <span class="comment">% For 'group' and 'individual' plots the tract data will be in data{2}</span>
0129     subjects = 1:length(data{2}(1).FA(:,1));
0130 <span class="keyword">end</span>
0131 <span class="comment">% subjects should be a row vector</span>
0132 <span class="keyword">if</span> size(subjects,2) &lt; size(subjects,1)
0133     subjects = subjects';
0134 <span class="keyword">end</span>
0135 
0136 <span class="comment">% generate random numbers for the figure windowss</span>
0137 fignums = ceil(rand(1,max(tracts)).*10000);
0138 
0139 <span class="comment">% If an afq structure was passed in then get the fiber group names from it</span>
0140 <span class="keyword">if</span> exist(<span class="string">'afq'</span>,<span class="string">'var'</span>)
0141     fgNames = <a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'fgnames'</span>);
0142 <span class="keyword">else</span>
0143     <span class="comment">% Otherwise assume that it is the mori groups and we know their names</span>
0144     fgNames={<span class="string">'Left Thalmic Radiation'</span>,<span class="string">'Right Thalmic Radiation'</span>,<span class="string">'Left Corticospinal'</span>,<span class="string">'Right Corticospinal'</span>, <span class="string">'Left Cingulum Cingulate'</span>, <span class="string">'Right Cingulum Cingulate'</span><span class="keyword">...</span>
0145         <span class="string">'Left Cingulum Hippocampus'</span>,<span class="string">'Right Cingulum Hippocampus'</span>, <span class="string">'Callosum Forceps Major'</span>, <span class="string">'Callosum Forceps Minor'</span><span class="keyword">...</span>
0146         <span class="string">'Left IFOF'</span>,<span class="string">'Right IFOF'</span>,<span class="string">'Left ILF'</span>,<span class="string">'Right ILF'</span>,<span class="string">'Left SLF'</span>,<span class="string">'Right SLF'</span>,<span class="string">'Left Uncinate'</span>,<span class="string">'Right Uncinate'</span>,<span class="string">'Left Arcuate'</span>,<span class="string">'Right Arcuate'</span>};
0147 <span class="keyword">end</span>
0148 
0149 <span class="comment">%% Group plots</span>
0150 <span class="comment">%  Plot the mean +/- 1 std. err. for each data set that is sent in</span>
0151 <span class="keyword">if</span> sum(strcmpi(<span class="string">'group'</span>,arg)) == 1
0152     <span class="comment">% If group names were not pulled from the afq structure then the should</span>
0153     <span class="comment">% have been passed in</span>
0154     <span class="keyword">if</span> ~exist(<span class="string">'gnames'</span>,<span class="string">'var'</span>)
0155         gnames = arg(1:length(data));
0156     <span class="keyword">end</span>
0157     <span class="comment">% define the colors to be used for each groups plot</span>
0158     c = lines(length(data));
0159     <span class="comment">% make sure that we have enough fiber group names</span>
0160     <span class="keyword">if</span> length(fgNames) &lt; max(tracts)
0161         fgNames{max(tracts)} = [];
0162     <span class="keyword">end</span>
0163     <span class="comment">% Loop over all the tracts</span>
0164     <span class="keyword">for</span> jj = 1 : length(tracts)
0165         <span class="comment">% For each tract loop over the number of groups and plot each</span>
0166         <span class="comment">% on the same plot</span>
0167         <span class="keyword">for</span> ii = 1 : length(data)
0168             figure(fignums(jj)); hold on;
0169             <span class="comment">% collect the value of interest</span>
0170             <span class="keyword">switch</span>(property)
0171                 <span class="keyword">case</span> <span class="string">'fa'</span>
0172                     vals = data{ii}(tracts(jj)).FA;
0173                     label = <span class="string">'Fractional Anisotropy'</span>;
0174                 <span class="keyword">case</span> <span class="string">'rd'</span>
0175                     vals = data{ii}(tracts(jj)).RD;
0176                     label = <span class="string">'Radial Diffusivity'</span>;
0177                 <span class="keyword">case</span> <span class="string">'ad'</span>
0178                     vals = data{ii}(tracts(jj)).AD;
0179                     label = <span class="string">'Axial Diffusivity'</span>;
0180                 <span class="keyword">case</span> <span class="string">'md'</span>
0181                     vals = data{ii}(tracts(jj)).MD;
0182                     label = <span class="string">'Mead Diffusivity'</span>;
0183             <span class="keyword">end</span>
0184             <span class="comment">% number of subjects with measurements for this tract</span>
0185             n  = sum(~isnan(vals(:,1)));
0186             <span class="comment">% group mean diffusion profile</span>
0187             m  = nanmean(vals);
0188             <span class="comment">% standard deviation at each node</span>
0189             sd = nanstd(vals);
0190             <span class="comment">% standard error of the mean at each node</span>
0191             se = sd./sqrt(n);
0192             <span class="comment">% plot the mean</span>
0193             h(ii) = plot(m,<span class="string">'-'</span>,<span class="string">'Color'</span>,c(ii,:),<span class="string">'linewidth'</span>,3);
0194             <span class="comment">% plot the confidence interval</span>
0195             plot(m+se,<span class="string">'--'</span>,<span class="string">'Color'</span>,c(ii,:));
0196             plot(m-se,<span class="string">'--'</span>,<span class="string">'Color'</span>,c(ii,:));
0197             <span class="comment">% label the axes etc.</span>
0198             xlabel(<span class="string">'Location'</span>,<span class="string">'fontName'</span>,<span class="string">'Times'</span>,<span class="string">'fontSize'</span>,12);
0199             ylabel(label,<span class="string">'fontName'</span>,<span class="string">'Times'</span>,<span class="string">'fontSize'</span>,12);
0200             title(fgNames{tracts(jj)},<span class="string">'fontName'</span>,<span class="string">'Times'</span>,<span class="string">'fontSize'</span>,12);
0201             set(gca,<span class="string">'fontName'</span>,<span class="string">'Times'</span>,<span class="string">'fontSize'</span>,12);
0202         <span class="keyword">end</span>
0203         <span class="comment">% add a legend to the plot</span>
0204         legend(h,gnames);
0205     <span class="keyword">end</span>    
0206 <span class="keyword">end</span>
0207 <span class="comment">%% Individual plots</span>
0208 <span class="comment">%  Plot the norms and confidence intervals then add each individual patient</span>
0209 <span class="comment">%  to the plot</span>
0210 <span class="keyword">if</span> sum(strcmpi(<span class="string">'individual'</span>,arg)) == 1
0211     <span class="comment">% The first set of data will be norms. Collect the property of interest</span>
0212     norms = data{1};
0213     <span class="comment">% number of nodes to be plotted</span>
0214     nnodes = size(data{1}.meanFA,1);
0215     <span class="comment">% collect the value of interest</span>
0216     <span class="keyword">switch</span>(property)
0217         <span class="keyword">case</span> <span class="string">'fa'</span>
0218             Meanvals = norms.meanFA;
0219             SDvals   = norms.sdFA;
0220             axisScale = [1 nnodes .2 .9];
0221             label = <span class="string">'Fractional Anisotropy'</span>;
0222         <span class="keyword">case</span> <span class="string">'rd'</span>
0223             Meanvals = norms.meanRD;
0224             SDvals   = norms.sdRD;
0225             axisScale = [1 nnodes .2 .9];
0226             label = <span class="string">'Radial Diffusivity'</span>;
0227         <span class="keyword">case</span> <span class="string">'ad'</span>
0228             Meanvals = norms.meanAD;
0229             SDvals   = norms.sdAD;
0230             axisScale = [1 nnodes 1 2.1];
0231             label = <span class="string">'Axial Diffusivity'</span>;
0232         <span class="keyword">case</span> <span class="string">'md'</span>
0233             Meanvals = norms.meanMD;
0234             SDvals   = norms.sdMD;
0235             axisScale = [1 nnodes .6 1.3];
0236             label = <span class="string">'Mead Diffusivity'</span>;
0237     <span class="keyword">end</span>
0238     <span class="comment">% make a legend if desired</span>
0239     <span class="keyword">if</span> sum(strcmpi(<span class="string">'legend'</span>,varargin)) &gt; 0
0240         L = varargin{find(strcmpi(<span class="string">'legend'</span>,varargin))+1};
0241     <span class="keyword">else</span>
0242         L = [];
0243     <span class="keyword">end</span>
0244     <span class="comment">% Define the confidence intervals to be plotted. Percentiles are</span>
0245     <span class="comment">% converted to z scores</span>
0246     <span class="keyword">if</span> sum(strcmpi(<span class="string">'ci'</span>,varargin)) &gt; 0
0247         cutoff = varargin{find(strcmpi(<span class="string">'ci'</span>,varargin))+1};
0248     <span class="keyword">else</span>
0249         <span class="comment">% if no confidence interval is defined use 10 and 90</span>
0250         cutoff = [10 90];
0251     <span class="keyword">end</span>
0252     cutZ=norminv(cutoff*.01);
0253     cutZ2=norminv([.25 .75]);
0254     <span class="comment">% plot the norms for each tract</span>
0255     <span class="keyword">for</span> jj = tracts
0256         figure(fignums(jj));hold on;
0257         <span class="comment">% plot 10 and 90 percentile bands unless the user defines another</span>
0258         <span class="comment">% confidence interval</span>
0259         x = [1:nnodes fliplr(1:nnodes)];
0260         y = vertcat(Meanvals(:,jj)+max(cutZ)*SDvals(:,jj), flipud(Meanvals(:,jj)+min(cutZ)*SDvals(:,jj)));
0261         fill(x,y, [.6 .6 .6]);
0262         clear y
0263         <span class="comment">% plot the 25 and 75 percentile bands</span>
0264         y = vertcat(Meanvals(:,jj)+max(cutZ2)*SDvals(:,jj), flipud(Meanvals(:,jj)+min(cutZ2)*norms.sdFA(:,jj)));
0265         fill(x,y, [.3 .3 .3]);
0266         clear y
0267         <span class="comment">% plot the mean</span>
0268         plot(Meanvals(:,jj),<span class="string">'-'</span>,<span class="string">'Color'</span>,<span class="string">'k'</span>,<span class="string">'LineWidth'</span>,5);
0269         <span class="comment">% scale the axes and name them</span>
0270         axis(axisScale);
0271         xlabel(<span class="string">'Location'</span>,<span class="string">'fontName'</span>,<span class="string">'Times'</span>,<span class="string">'fontSize'</span>,12);
0272         ylabel(label,<span class="string">'fontName'</span>,<span class="string">'Times'</span>,<span class="string">'fontSize'</span>,12)
0273         title(fgNames{jj},<span class="string">'fontName'</span>,<span class="string">'Times'</span>,<span class="string">'fontSize'</span>,12)
0274         set(gcf,<span class="string">'Color'</span>,<span class="string">'w'</span>);
0275         set(gca,<span class="string">'Color'</span>,[.9 .9 .9],<span class="string">'fontName'</span>,<span class="string">'Times'</span>,<span class="string">'fontSize'</span>,12)
0276     <span class="keyword">end</span>
0277     <span class="comment">% the second set of data will be individual subjects</span>
0278     subData = data{2};
0279     <span class="comment">% define the colors to be used for each individual</span>
0280     c = hsv(length(subData(1).FA(:,1))).*0.6;
0281     <span class="comment">% Loop over all the tracts</span>
0282     <span class="keyword">for</span> jj = tracts
0283         figure(fignums(jj));
0284         <span class="comment">% Collect the property of interest for tract jj</span>
0285         subVals = [];
0286         <span class="keyword">switch</span>(property)
0287             <span class="keyword">case</span> <span class="string">'fa'</span>
0288                 subVals = subData(jj).FA;
0289             <span class="keyword">case</span> <span class="string">'rd'</span>
0290                 subVals = subData(jj).RD;
0291             <span class="keyword">case</span> <span class="string">'ad'</span>
0292                 subVals = subData(jj).AD;
0293             <span class="keyword">case</span> <span class="string">'md'</span>
0294                 subVals = subData(jj).MD;
0295         <span class="keyword">end</span>
0296         <span class="comment">% For each tract loop over the number of subjects and plot each</span>
0297         <span class="comment">% on the same plot with the norms</span>
0298         <span class="keyword">for</span> ii = subjects
0299             h(ii) = plot(subVals(ii,:)',<span class="string">'--'</span>,<span class="string">'Color'</span>,c(ii,:),<span class="string">'linewidth'</span>,2);
0300         <span class="keyword">end</span>
0301         <span class="comment">% add a legend to the plot if desired</span>
0302         <span class="keyword">if</span> ~isempty(L)
0303             legend(h(subjects),L);
0304         <span class="keyword">end</span>
0305     <span class="keyword">end</span>   
0306 <span class="keyword">end</span>
0307 
0308 <span class="comment">%% Colormap plots</span>
0309 <span class="comment">% Plot each individual subject and the group mean.  The Color of the group</span>
0310 <span class="comment">% mean will vary based on the value at that location on the tract profile.</span>
0311 <span class="keyword">if</span> sum(strcmpi(<span class="string">'colormap'</span>,arg)) == 1
0312     <span class="comment">% Check if a legend is desired</span>
0313     <span class="keyword">if</span> sum(strcmpi(<span class="string">'legend'</span>,varargin)) &gt; 0
0314         L = varargin{find(strcmpi(<span class="string">'legend'</span>,varargin))+1};
0315     <span class="keyword">else</span> 
0316         L = [];
0317     <span class="keyword">end</span>
0318     <span class="comment">% Check if the colormap range is defined</span>
0319     <span class="keyword">if</span> sum(strcmpi(<span class="string">'cmap'</span>,varargin)) &gt; 0
0320         FArange = varargin{find(strcmpi(<span class="string">'cmap'</span>,varargin))+1};
0321     <span class="keyword">else</span>
0322         FArange = [.3 .6];
0323     <span class="keyword">end</span>
0324     <span class="comment">% the first set of data will be individual subjects</span>
0325     subData = data{1};
0326     <span class="comment">% number of nodes to be plotted</span>
0327     nnodes = length(subData(1).FA(1,:));
0328     
0329     <span class="comment">% Loop over all the tracts</span>
0330     <span class="keyword">for</span> jj = 1 : length(tracts)
0331         <span class="comment">% collect the property of interest for tract jj</span>
0332         <span class="keyword">switch</span>(property)
0333             <span class="keyword">case</span> <span class="string">'fa'</span>
0334                 subVals = subData(tracts(jj)).FA;
0335                 axisScale = [1 nnodes .2 .9];
0336                 label = <span class="string">'Fractional Anisotropy'</span>;
0337             <span class="keyword">case</span> <span class="string">'rd'</span>
0338                 subVals = subData(tracts(jj)).RD;
0339                 axisScale = [1 nnodes .2 .9];
0340                 label = <span class="string">'Radial Diffusivity'</span>;
0341             <span class="keyword">case</span> <span class="string">'ad'</span>
0342                 subVals = subData(tracts(jj)).AD;
0343                 axisScale = [1 nnodes 1 2.1];
0344                 label = <span class="string">'Axial Diffusivity'</span>;
0345             <span class="keyword">case</span> <span class="string">'md'</span>
0346                 subVals = subData(tracts(jj)).MD;
0347                 axisScale = [1 nnodes .6 1.3];
0348                 label = <span class="string">'Mean Diffusivity'</span>;
0349         <span class="keyword">end</span>
0350         
0351         figure(fignums(jj)); hold on;
0352         <span class="comment">% For each tract loop over the number of subjects and plot each</span>
0353         <span class="comment">% on the same axis</span>
0354         <span class="keyword">for</span> ii = 1 : length(subVals(:,1))
0355             h(ii) = plot(subVals(ii,:)',<span class="string">'-'</span>,<span class="string">'Color'</span>,[.5 .5 .5],<span class="string">'linewidth'</span>,1);
0356         <span class="keyword">end</span>
0357         <span class="comment">% add a legend to the plot if desired</span>
0358         <span class="keyword">if</span> ~isempty(L)
0359             legend(h(1:length(L)),L);
0360         <span class="keyword">end</span>
0361     <span class="keyword">end</span>
0362     
0363     <span class="comment">% To plot the mean we will heatmap each location on the mean</span>
0364     <span class="comment">% profile based on it's FA value and plot a sphere there.</span>
0365     <span class="keyword">for</span> jj=1:length(tracts)
0366         figure(fignums(jj));hold on;
0367         <span class="comment">% compute the mean tract profile</span>
0368         meanTP = nanmean(subData(tracts(jj)).FA);
0369         <span class="comment">% Interpolate the mean profile so the heatmap transitions smoothly</span>
0370         meanTPinterp = interp1(1:100,meanTP,linspace(1,100,1000));
0371         <span class="comment">% Set the colormap</span>
0372         c = jet(256);
0373         <span class="comment">% Create a evenly spaced linear mapping between values in the tract</span>
0374         <span class="comment">% profile and colors in the colormap</span>
0375         lm = linspace(FArange(1), FArange(2),256);
0376         <span class="comment">% Compute the apropriate color for each point on the tract profile</span>
0377         <span class="keyword">for</span> k = 1:length(meanTPinterp)
0378             d = [];
0379             d = abs(meanTPinterp(k) - lm);
0380             [tmp, mcolor(k)] = min(d);
0381         <span class="keyword">end</span>
0382         <span class="comment">% Plot each point on the tract profile a circle of the apropriate</span>
0383         <span class="comment">% color</span>
0384         <span class="keyword">for</span> k = 1:1000
0385             plot(k./10,meanTPinterp(k),<span class="string">'.'</span>,<span class="string">'Color'</span>,c(mcolor(k),:),<span class="string">'markersize'</span>,40);
0386         <span class="keyword">end</span>
0387         <span class="comment">% scale the axes and name them</span>
0388         axis(axisScale);
0389         xlabel(<span class="string">'Location'</span>,<span class="string">'fontName'</span>,<span class="string">'Times'</span>,<span class="string">'fontSize'</span>,12);
0390         ylabel(label,<span class="string">'fontName'</span>,<span class="string">'Times'</span>,<span class="string">'fontSize'</span>,12)
0391         title(fgNames{tracts(jj)},<span class="string">'fontName'</span>,<span class="string">'Times'</span>,<span class="string">'fontSize'</span>,12)
0392         set(gcf,<span class="string">'Color'</span>,<span class="string">'w'</span>);
0393         set(gca,<span class="string">'fontName'</span>,<span class="string">'Times'</span>,<span class="string">'fontSize'</span>,12)
0394     <span class="keyword">end</span>
0395 <span class="keyword">end</span>
0396 <span class="comment">%% Save figures if an output directory is defined</span>
0397 <span class="keyword">if</span> savefigs==1
0398     cd(outdir)
0399     <span class="keyword">for</span> ii=1:length(fa)
0400         figure(ii);
0401         set(gcf,<span class="string">'Color'</span>,<span class="string">'w'</span>,<span class="string">'InvertHardCopy'</span>,<span class="string">'off'</span>,<span class="string">'PaperPositionMode'</span>,<span class="string">'auto'</span>);
0402         saveas(gcf,[<span class="string">'Figure'</span> num2str(ii)],<span class="string">'png'</span>);
0403     <span class="keyword">end</span>
0404 <span class="keyword">end</span>
0405</pre></div>
<hr><address>Generated on Wed 05-Dec-2012 12:03:42 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>