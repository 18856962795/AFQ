<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of AFQ_Create</title>
  <meta name="keywords" content="AFQ_Create">
  <meta name="description" content="Create AFQ structure and set default parameters">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">functions</a> &gt; AFQ_Create.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for functions&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>AFQ_Create
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Create AFQ structure and set default parameters</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function afq = AFQ_Create(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Create AFQ structure and set default parameters

    afq = AFQ_Create(varargin)

 Creates anautomated fiber quantification (AFQ) structure.  The default
 fields are put in place and filled with default values.  The default
 parameters can also be changed and this will affect later stages of the
 AFQ pipeline.  The arguments to the function are in the form
 'parameter','value'.  For example, if you call the function with

    AFQ_Create('cutoff',[5 95],'sub_group',[1 1 1 0 0 0]);
 The afq.params.cutoff parameter will be set to [5 95] rather than the
 default which is [10 90] and the subject groups will be defined for the
 six subjects (3 patients and 3 controls).
 

 See Also: <a href="AFQ_set.html" class="code" title="function afq = AFQ_set(afq,param,varargin)">AFQ_Set</a> <a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_Get</a>

 Examples:
    afq = <a href="AFQ_Create.html" class="code" title="function afq = AFQ_Create(varargin)">AFQ_Create</a>;
    afq = AFQ_Create('runmode','test');


 (c) Jason D. Yeatman December 2011</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="AFQ_CreateTractProfile.html" class="code" title="function TractProfile = AFQ_CreateTractProfile(varargin)">AFQ_CreateTractProfile</a>	Create the AFQ Tract Profile structure</li><li><a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>	Get value from afq structure</li><li><a href="../utilities/AFQ_mrtrixInit.html" class="code" title="function files = AFQ_mrtrixInit(dt6, lmax, mrtrix_folder)">AFQ_mrtrixInit</a>	function files = AFQ_mrtrixInit(dt6, lmax, mrtrix_folder)</li><li><a href="../utilities/afqVarargin.html" class="code" title="function yourStruct = afqVarargin(yourStruct,varArgIn)">afqVarargin</a>	</li><li><a href="../utilities/check_mrTrix.html" class="code" title="function [status mrTrixpaths] = check_mrTrix">check_mrTrix</a>	Check to see if mrTrix functions are installed on the system</li><li><a href="../utilities/check_mrvista.html" class="code" title="function status = check_mrvista;">check_mrvista</a>	Check if mrvista is in the matlab search path</li><li><a href="../utilities/check_spm.html" class="code" title="function status = check_spm">check_spm</a>	Check if spm is in the matlab search path</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="AFQ_run.html" class="code" title="function [afq patient_data control_data norms abn abnTracts] = AFQ_run(sub_dirs, sub_group, afq)">AFQ_run</a>	Run AFQ analysis on a set of subjects to generate Tract Profiles of white</li><li><a href="../test/AFQ_test.html" class="code" title="function AFQ_test">AFQ_test</a>	Perform unit testing on all the AFQ functions.</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function afq = AFQ_Create(varargin)</a>
0002 <span class="comment">% Create AFQ structure and set default parameters</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%    afq = AFQ_Create(varargin)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Creates anautomated fiber quantification (AFQ) structure.  The default</span>
0007 <span class="comment">% fields are put in place and filled with default values.  The default</span>
0008 <span class="comment">% parameters can also be changed and this will affect later stages of the</span>
0009 <span class="comment">% AFQ pipeline.  The arguments to the function are in the form</span>
0010 <span class="comment">% 'parameter','value'.  For example, if you call the function with</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%    AFQ_Create('cutoff',[5 95],'sub_group',[1 1 1 0 0 0]);</span>
0013 <span class="comment">% The afq.params.cutoff parameter will be set to [5 95] rather than the</span>
0014 <span class="comment">% default which is [10 90] and the subject groups will be defined for the</span>
0015 <span class="comment">% six subjects (3 patients and 3 controls).</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% See Also: AFQ_Set AFQ_Get</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% Examples:</span>
0021 <span class="comment">%    afq = AFQ_Create;</span>
0022 <span class="comment">%    afq = AFQ_Create('runmode','test');</span>
0023 <span class="comment">%</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% (c) Jason D. Yeatman December 2011</span>
0026 <span class="comment">%</span>
0027 
0028 <span class="comment">%% Define the type of structure</span>
0029 afq.type = <span class="string">'afq version 1'</span>;
0030 <span class="comment">%% Names of all the fiber groups</span>
0031 afq.fgnames = {<span class="string">'Left Thalamic Radiation'</span>,<span class="string">'Right Thalamic Radiation'</span>,<span class="string">'Left Corticospinal'</span>,<span class="string">'Right Corticospinal'</span>, <span class="string">'Left Cingulum Cingulate'</span>, <span class="string">'Right Cingulum Cingulate'</span><span class="keyword">...</span>
0032     <span class="string">'Left Cingulum Hippocampus'</span>,<span class="string">'Right Cingulum Hippocampus'</span>, <span class="string">'Callosum Forceps Major'</span>, <span class="string">'Callosum Forceps Minor'</span><span class="keyword">...</span>
0033     <span class="string">'Left IFOF'</span>,<span class="string">'Right IFOF'</span>,<span class="string">'Left ILF'</span>,<span class="string">'Right ILF'</span>,<span class="string">'Left SLF'</span>,<span class="string">'Right SLF'</span>,<span class="string">'Left Uncinate'</span>,<span class="string">'Right Uncinate'</span>,<span class="string">'Left Arcuate'</span>,<span class="string">'Right Arcuate'</span>};
0034 
0035 <span class="comment">%% Attach a structure of values to the afq structure</span>
0036 vals.fa = {};
0037 vals.md = {};
0038 vals.rd = {};
0039 vals.ad = {};
0040 vals.cl = {};
0041 afq.vals = vals;
0042 
0043 <span class="comment">%% Attach a cell array of subject names to the afq structure</span>
0044 afq.sub_names = {};
0045 
0046 <span class="comment">%% Attach a vector of subject groups to afq structure</span>
0047 afq.sub_group = [];
0048 
0049 <span class="comment">%% Attach a vector of subject id numbers to the afq structure</span>
0050 afq.sub_nums = [];
0051 
0052 <span class="comment">%% Attach a cell array of subject directories to the afq structure</span>
0053 afq.sub_dirs = {};
0054 
0055 <span class="comment">%% Attach a vector to define each subject's group</span>
0056 afq.sub_group = [];
0057 
0058 <span class="comment">%% Attach the tract profile structure to the afq structure</span>
0059 
0060 afq.TractProfiles = <a href="AFQ_CreateTractProfile.html" class="code" title="function TractProfile = AFQ_CreateTractProfile(varargin)">AFQ_CreateTractProfile</a>;
0061 <span class="comment">% % Add a field to afq.TractProfiles for each tract defined above</span>
0062 <span class="comment">% for ii = 1:length(fgNames)</span>
0063 <span class="comment">%     afq.TractProfiles.(fgNames{ii}) = AFQ_CreateTractProfile('name',fgNames{ii});</span>
0064 <span class="comment">% end</span>
0065 
0066 <span class="comment">%% Check which software packages are installed</span>
0067 afq.software.mrvista = <a href="../utilities/check_mrvista.html" class="code" title="function status = check_mrvista;">check_mrvista</a>;
0068 afq.software.mrtrix = <a href="../utilities/check_mrTrix.html" class="code" title="function [status mrTrixpaths] = check_mrTrix">check_mrTrix</a>;
0069 afq.software.spm = <a href="../utilities/check_spm.html" class="code" title="function status = check_spm">check_spm</a>;
0070 
0071 <span class="comment">%% Set the afq.params structure with default parameters</span>
0072 <span class="comment">%  cutoff: The percentile cutoff to be used to determine what is &quot;abnormal&quot;</span>
0073 <span class="comment">%  The default is cutoff = [10 90] meaning that subjects who fall below the</span>
0074 <span class="comment">%  10th percentile or above the 90th percentile will be considered</span>
0075 <span class="comment">%  &quot;abnormal&quot; and their data will be plotted with respect to the control</span>
0076 <span class="comment">%  population</span>
0077 <span class="comment">%  Example: params.cutoff = [10 90];</span>
0078 afq.params.cutoff = [10 90];
0079 <span class="comment">%  run_mode: normally leave this blank unless you just want to test this</span>
0080 <span class="comment">%  script on a new dataset.  If this is the case then set run_mode = 'test'</span>
0081 <span class="comment">%  in which case many fewer fibers will be tracked and segmented to allow</span>
0082 <span class="comment">%  for fast testing/debugging of the script</span>
0083 afq.params.run_mode = [];
0084 <span class="comment">% cleanFibers = 1 means that once all the fiber groups have been segmented</span>
0085 <span class="comment">% they will be cleaned such that any fiber that (1) any fiber that is more</span>
0086 <span class="comment">% than params.maxLen standard deviations above the mean fiber length will</span>
0087 <span class="comment">% be removed and and (2) any fiber that is more than params.maxDist</span>
0088 <span class="comment">% standard deviations from the core of the tract will be removed.  this</span>
0089 <span class="comment">% means that fibers groups will be forced to be a compact bundle</span>
0090 afq.params.cleanFibers = 1;
0091 <span class="comment">% Maximum number of iteration of the cleaning algorithm</span>
0092 afq.params.cleanIter = 5;
0093 <span class="comment">% Remove fibers that are more than maxDist standard deviations from the</span>
0094 <span class="comment">% core of the tract</span>
0095 afq.params.maxDist = 5;
0096 <span class="comment">% Remove fibers that are more than maxLen standard deviations from the</span>
0097 <span class="comment">% mean fiber length</span>
0098 afq.params.maxLen = 4;
0099 <span class="comment">% The number of nodes to represent each fiber</span>
0100 afq.params.numberOfNodes = 100;
0101 <span class="comment">% Should we analyze the whole length of the fiber group or just the central</span>
0102 <span class="comment">% portion spanning between 2 ROIs</span>
0103 afq.params.clip2rois = 1;
0104 <span class="comment">% Set the amount of weighting that will be applied when calculating tract</span>
0105 <span class="comment">% profiles. 0 meanse that each fiber contributes equally. 1 means that we</span>
0106 <span class="comment">% apply gaussian weighting where each fibers contribution to the</span>
0107 <span class="comment">% measurement at a node is weighted by its gaussian distance from the tract</span>
0108 <span class="comment">% core. Values greater than 1 mean that the core of the tract is weighted</span>
0109 <span class="comment">% more heavily and fibers futher from the core are weighted less heavily</span>
0110 <span class="comment">% (faster fall off than a gaussian).  See AFQ_ComputeTractProperties</span>
0111 afq.params.fiberWeighting = 1;
0112 <span class="comment">% If params.cleanFibers==1, then this will indicate whether to perform the</span>
0113 <span class="comment">% cleaning on just the clipped portion of the tract or on the full tract.</span>
0114 <span class="comment">% This may be helpful for tracts like the ILF that are extremely messy with</span>
0115 <span class="comment">% looping fibers etc.</span>
0116 afq.params.cleanClippedFibers = 0;
0117 <span class="comment">% The directory to save all output figures and results</span>
0118 afq.params.outdir = [];
0119 <span class="comment">% Show figures? yes or no</span>
0120 afq.params.showfigs = true;
0121 <span class="comment">% Save figures? yes or no</span>
0122 afq.params.savefigs = false;
0123 <span class="comment">% Whether or not to compute constrained spherical deconvolution using</span>
0124 <span class="comment">% mrtrix</span>
0125 afq.params.computeCSD = 0;
0126 <span class="comment">%% AFQ Fiber Tracking parameters</span>
0127 <span class="comment">% Do fiber tracking with mrdiffusion by default. The other option is</span>
0128 <span class="comment">% 'mrtrix' if it is installed and the data is HARDI</span>
0129 afq.params.track.algorithm = <span class="string">'mrdiffusion'</span>;
0130 <span class="comment">% Distance between steps in the tractography algoithm</span>
0131 afq.params.track.stepSizeMm = 1;
0132 <span class="comment">% Stopping criteria FA&lt;0.2</span>
0133 afq.params.track.faThresh = 0.2;
0134 <span class="comment">% Discard Fibers shorter than 50mm or longer than 250mm</span>
0135 afq.params.track.lengthThreshMm = [50 250];
0136 <span class="comment">% Stopping criteria angle between steps &gt;30 degrees</span>
0137 afq.params.track.angleThresh = 30;
0138 <span class="comment">% Unknown.....</span>
0139 afq.params.track.wPuncture = 0.2;
0140 <span class="comment">% There are multip.e algorithms that can be used.  We prefer STT. See:</span>
0141 <span class="comment">% Basser PJ, Pajevic S, Pierpaoli C, Duda J, Aldroubi A. 2000.</span>
0142 <span class="comment">% In vivo fiber tractography using DT-MRI data.</span>
0143 <span class="comment">% Magnetic Resonance in Medicine 44(4):625-32.</span>
0144 afq.params.track.whichAlgorithm = 1;
0145 <span class="comment">% Interpolation method. After each step we interpolate the tensor at that</span>
0146 <span class="comment">% point. Trilinear interpolation works well.</span>
0147 afq.params.track.whichInterp = 1;
0148 <span class="comment">% This adds some randomness to each seed point. Each seed point is move</span>
0149 <span class="comment">% randomly by randn*.1mm</span>
0150 afq.params.track.offsetJitter = 0;
0151 <span class="comment">% We seed in voxel in multiple locations. [0.25 and 0.75] Seeds each voxel</span>
0152 <span class="comment">% at 8 equidistant locations.  For one seed in the middle of the voxel use</span>
0153 <span class="comment">% afq.params.track.seedVoxelOffsets = 0.5;</span>
0154 afq.params.track.seedVoxelOffsets = [0.25 0.75];
0155 <span class="comment">% Mask from which to initialize tracking</span>
0156 afq.params.track.faMaskThresh = 0.30;
0157 
0158 <span class="comment">% TODO:</span>
0159 <span class="comment">%  Write a parameter translation routine based on mrvParamFormat()</span>
0160 <span class="comment">%  This will translate all of the parameters into the right format for the</span>
0161 <span class="comment">%  afq parameters structure.</span>
0162 
0163 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0164 <span class="comment">%% Modify default parameters based on user input                          %</span>
0165 afq = <a href="../utilities/afqVarargin.html" class="code" title="function yourStruct = afqVarargin(yourStruct,varArgIn)">afqVarargin</a>(afq, varargin);                                         <span class="comment">%</span>
0166 afq.params = <a href="../utilities/afqVarargin.html" class="code" title="function yourStruct = afqVarargin(yourStruct,varArgIn)">afqVarargin</a>(afq.params, varargin);     
0167 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0168 
0169 <span class="comment">%% Modify tracking parameters if the mode is test mode</span>
0170 <span class="keyword">if</span> strcmp(afq.params.run_mode,<span class="string">'test'</span>)
0171     afq.params.track.seedVoxelOffsets = [0.5];
0172     afq.params.track.faMaskThresh = 0.35;
0173 <span class="keyword">end</span>
0174 <span class="comment">%% Attach a structure pointing to each subjects data files</span>
0175 <span class="keyword">for</span> ii = 1: <a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'num subs'</span>)
0176     afq.files.dt6{ii} = fullfile(afq.sub_dirs{ii},<span class="string">'dt6.mat'</span>);
0177     <span class="keyword">if</span> ~exist(<a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'dt6 path'</span>,ii))
0178         error(<span class="string">'%s file does not exist'</span>,<a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'dt6 path'</span>,ii))
0179     <span class="keyword">end</span>
0180 <span class="keyword">end</span>
0181 afq.files.images            = struct(<span class="string">'name'</span>,{},<span class="string">'path'</span>,{});
0182 afq.files.fibers.wholebrain = cell(<a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'num subs'</span>),1);
0183 afq.files.fibers.segmented  = cell(<a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'num subs'</span>),1);
0184 afq.files.fibers.clean      = cell(<a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'num subs'</span>),1);
0185 
0186 <span class="comment">%% Add files from previous AFQ runs to afq structure</span>
0187 <span class="keyword">for</span> ii = 1:<a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'num subs'</span>)
0188     fibDir = fullfile(afq.sub_dirs{ii},<span class="string">'fibers'</span>);
0189     wholebrainFG = fullfile(fibDir,<span class="string">'WholeBrainFG.mat'</span>);
0190     segmentedFG = fullfile(fibDir,<span class="string">'MoriGroups.mat'</span>);
0191     cleanFG = fullfile(fibDir,[<span class="string">'MoriGroups_clean_D'</span> num2str(afq.params.maxDist) <span class="string">'_L'</span>  num2str(afq.params.maxLen) <span class="string">'.mat'</span>]);
0192     <span class="keyword">if</span> exist(wholebrainFG,<span class="string">'file'</span>)
0193         afq.files.fibers.wholebrain{ii} = wholebrainFG;
0194     <span class="keyword">end</span>
0195     <span class="keyword">if</span> exist(segmentedFG,<span class="string">'file'</span>)
0196         afq.files.fibers.segmented{ii} = segmentedFG;
0197     <span class="keyword">end</span>
0198     <span class="keyword">if</span> exist(cleanFG,<span class="string">'file'</span>)
0199         afq.files.fibers.clean{ii} = cleanFG;
0200     <span class="keyword">end</span>
0201 <span class="keyword">end</span>
0202 <span class="comment">%% Allow previous analyses to be overwritten</span>
0203 afq.overwrite.fibers.wholebrain = zeros(<a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'num subs'</span>),1);
0204 afq.overwrite.fibers.segmented = zeros(<a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'num subs'</span>),1);
0205 afq.overwrite.fibers.clean = zeros(<a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'num subs'</span>),1);
0206 afq.overwrite.vals = zeros(<a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'num subs'</span>,1));
0207 
0208 <span class="comment">%% If desired compute constrained spherical deconvolution with mr trix</span>
0209 
0210 <span class="comment">% If mr trix is installed and CSD is computed then perform tracking on</span>
0211 <span class="comment">% constrained spherical deconvolution</span>
0212 <span class="keyword">if</span> afq.software.mrtrix == 1 &amp;&amp; afq.params.computeCSD == 1
0213     afq.params.track.algorithm = <span class="string">'mrtrix'</span>;
0214 <span class="keyword">end</span>
0215 
0216 <span class="keyword">if</span> <a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'use mrtrix'</span>)
0217     <span class="keyword">for</span> ii = 1:<a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq,<span class="string">'num subs'</span>)
0218         files = <a href="../utilities/AFQ_mrtrixInit.html" class="code" title="function files = AFQ_mrtrixInit(dt6, lmax, mrtrix_folder)">AFQ_mrtrixInit</a>(<a href="AFQ_get.html" class="code" title="function val = AFQ_get(afq, param, varargin)">AFQ_get</a>(afq, <span class="string">'dt6 path'</span>,ii));
0219         afq.files.mrtrix.csd{ii} = files.csd;
0220         afq.files.mrtrix.wm{ii} = files.wm;
0221     <span class="keyword">end</span>
0222 <span class="keyword">end</span>
0223 
0224 <span class="keyword">return</span></pre></div>
<hr><address>Generated on Wed 14-Nov-2012 17:12:08 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>