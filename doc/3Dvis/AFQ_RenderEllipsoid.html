<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of AFQ_RenderEllipsoid</title>
  <meta name="keywords" content="AFQ_RenderEllipsoid">
  <meta name="description" content="Plot a diffusion ellipsoid from a tensor">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">3Dvis</a> &gt; AFQ_RenderEllipsoid.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for 3Dvis&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>AFQ_RenderEllipsoid
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Plot a diffusion ellipsoid from a tensor</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function xyzData = AFQ_RenderEllipsoid(Q,C,N,color,newFigure) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">Plot a diffusion ellipsoid from a tensor

    xyzData = ellipsoidFromTensor(Q,[C=[0,0,0]],[N=12],[newFigure=1])

 Q:  The tensor  ADC = uQu'
 C:  an x,y,z coordinate for the tensor center in 3 space
 N:  number of sample points on the surface of the tensor
 newFig:  Default = 1, plot a new figure.  0 means just plot on gcf.

 The that the diffusion ellipsoid has a tensor that is inverse to Q. See
 below.

 The ellipsoid points are vectors, v, that solve

   vQv = 1

 If we find for a unit vector, u, that uQu = k, then the vector 
    v = u/sqrt(k) 

 Then a solution for the ellipsoid will be

    u/sqrt(k) * Q * u/sqrt(k) = 1,

 So the points on the ellipsoid are v = u/sqrt(u'Qu)

 The diffusion ellipsoid for a tensor, Q, depends on the inverse of Q
 rather than Q.  When the diffusion ADC is large, the ellipsoid will be
 large in that direction.  If we solve the ADC for direction u as above,
 then the length of the solutiion will be (1/ADC)*u, which is small. 

 We need a clearer physics explanation of why Q (ADC = uQu') and the
 ellipsoid (ellipsoid solution to inv(Q)) are this way.  Get this for
 class!

 So for a tensor that predicts ADC = uQu', we plot the ellipsoid
 corresponding to inv(Q).

 Examples:
  Created from mictSimple data set
     t = dt6.dt6(50,40,40,:);
     Q = [t(1), t(4), t(5);
          t(4), t(2), t(6);
          t(5), t(6), t(3)];
     ellipsoidFromTensor(Q,[],20);

     xyzData = ellipsoidFromTensor(Q,[],30);
     cmap = autumn(255);
     surf(xyzData.x,xyzData.y,xyzData.z,repmat(256,size(xyzData.z)),'EdgeAlpha',0.1); 
     axis equal, colormap([cmap; .25 .25 .25]), alpha(0.5)    
     camlight; lighting phong; material shiny;
     set(gca, 'Projection', 'perspective');

 See also:  s_mictSimple

 (c) Stanford VISTA Team</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../utilities/simulateDiffusion.html" class="code" title="">simulateDiffusion</a>	% Simulate diffusion</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function xyzData = AFQ_RenderEllipsoid(Q,C,N,color,newFigure)</a>
0002 <span class="comment">%Plot a diffusion ellipsoid from a tensor</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%    xyzData = ellipsoidFromTensor(Q,[C=[0,0,0]],[N=12],[newFigure=1])</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Q:  The tensor  ADC = uQu'</span>
0007 <span class="comment">% C:  an x,y,z coordinate for the tensor center in 3 space</span>
0008 <span class="comment">% N:  number of sample points on the surface of the tensor</span>
0009 <span class="comment">% newFig:  Default = 1, plot a new figure.  0 means just plot on gcf.</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% The that the diffusion ellipsoid has a tensor that is inverse to Q. See</span>
0012 <span class="comment">% below.</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% The ellipsoid points are vectors, v, that solve</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%   vQv = 1</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% If we find for a unit vector, u, that uQu = k, then the vector</span>
0019 <span class="comment">%    v = u/sqrt(k)</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% Then a solution for the ellipsoid will be</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%    u/sqrt(k) * Q * u/sqrt(k) = 1,</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% So the points on the ellipsoid are v = u/sqrt(u'Qu)</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% The diffusion ellipsoid for a tensor, Q, depends on the inverse of Q</span>
0028 <span class="comment">% rather than Q.  When the diffusion ADC is large, the ellipsoid will be</span>
0029 <span class="comment">% large in that direction.  If we solve the ADC for direction u as above,</span>
0030 <span class="comment">% then the length of the solutiion will be (1/ADC)*u, which is small.</span>
0031 <span class="comment">%</span>
0032 <span class="comment">% We need a clearer physics explanation of why Q (ADC = uQu') and the</span>
0033 <span class="comment">% ellipsoid (ellipsoid solution to inv(Q)) are this way.  Get this for</span>
0034 <span class="comment">% class!</span>
0035 <span class="comment">%</span>
0036 <span class="comment">% So for a tensor that predicts ADC = uQu', we plot the ellipsoid</span>
0037 <span class="comment">% corresponding to inv(Q).</span>
0038 <span class="comment">%</span>
0039 <span class="comment">% Examples:</span>
0040 <span class="comment">%  Created from mictSimple data set</span>
0041 <span class="comment">%     t = dt6.dt6(50,40,40,:);</span>
0042 <span class="comment">%     Q = [t(1), t(4), t(5);</span>
0043 <span class="comment">%          t(4), t(2), t(6);</span>
0044 <span class="comment">%          t(5), t(6), t(3)];</span>
0045 <span class="comment">%     ellipsoidFromTensor(Q,[],20);</span>
0046 <span class="comment">%</span>
0047 <span class="comment">%     xyzData = ellipsoidFromTensor(Q,[],30);</span>
0048 <span class="comment">%     cmap = autumn(255);</span>
0049 <span class="comment">%     surf(xyzData.x,xyzData.y,xyzData.z,repmat(256,size(xyzData.z)),'EdgeAlpha',0.1);</span>
0050 <span class="comment">%     axis equal, colormap([cmap; .25 .25 .25]), alpha(0.5)</span>
0051 <span class="comment">%     camlight; lighting phong; material shiny;</span>
0052 <span class="comment">%     set(gca, 'Projection', 'perspective');</span>
0053 <span class="comment">%</span>
0054 <span class="comment">% See also:  s_mictSimple</span>
0055 <span class="comment">%</span>
0056 <span class="comment">% (c) Stanford VISTA Team</span>
0057 <span class="keyword">if</span> notDefined(<span class="string">'N'</span>), N = 20; <span class="keyword">end</span>      <span class="comment">% number of points on the sphere</span>
0058 <span class="keyword">if</span> notDefined(<span class="string">'C'</span>), C = [0,0,0]; <span class="keyword">end</span> <span class="comment">% coordinates of the points in 3D space</span>
0059 <span class="keyword">if</span> notDefined(<span class="string">'newFigure'</span>), newFigure = 1; <span class="keyword">end</span>
0060 <span class="keyword">if</span> ~exist(<span class="string">'color'</span>,<span class="string">'var'</span>) || isempty(color)
0061     color = [1 0.55 0];
0062 <span class="keyword">end</span>
0063 <span class="comment">% Make unit vectors on a sphere, u</span>
0064 [x,y,z] = sphere(N);   <span class="comment">% build a sphere sampled with N resolution</span>
0065 u = [x(:), y(:), z(:)];<span class="comment">% reorganize the univectors on the sheres (basically the diffusion directions scaled to the unit sphere)</span>
0066 
0067 sphAdc = zeros(size(u,1),1);
0068 <span class="keyword">for</span> ii=1:size(u,1)
0069     <span class="comment">% Notice that this is multiplying by inv(Q), not Q.</span>
0070     <span class="comment">% Uncomment to see the equivalence of</span>
0071     <span class="comment">%sphADC(ii) = u(ii,:)*inv(Q)*u(ii,:)';</span>
0072      sphAdc(ii) = u(ii,:)*(Q\u(ii,:)');
0073 <span class="keyword">end</span>
0074 
0075 <span class="comment">% The sqrt ADC is multipled into the unit vector because the factor is</span>
0076 <span class="comment">% multiplied in twice (left and right side of inv(Q)).</span>
0077 v = diag(1 ./ sphAdc.^0.5)*u;  <span class="comment">%Unit vectors in the rows.  Each row scaled.</span>
0078 
0079 <span class="comment">% Now reshape and plot</span>
0080 sz = size(x);
0081 x = reshape(v(:,1),sz);
0082 y = reshape(v(:,2),sz);
0083 z = reshape(v(:,3),sz);
0084 x = x + C(1); y = y + C(2); z = z + C(3);
0085 
0086 <span class="comment">% No return arguments, so make the plot.</span>
0087 <span class="keyword">if</span> nargout == 0
0088     <span class="keyword">if</span> newFigure
0089         h = mrvNewGraphWin; set(h,<span class="string">'Name'</span>,<span class="string">'EllipsoidFromTensor'</span>);
0090     <span class="keyword">end</span>
0091     <span class="comment">% Set the coloring for the surface</span>
0092     c(:,:,1) = repmat(color(1),size(z));
0093     c(:,:,2) = repmat(color(2),size(z));
0094     c(:,:,3) = repmat(color(3),size(z));
0095     
0096     surf(x,y,z,c,<span class="string">'EdgeAlpha'</span>,0.1);
0097     
0098     axis equal, alpha(0.5)
0099     camlight; lighting phong; material shiny;
0100     set(gca, <span class="string">'Projection'</span>, <span class="string">'perspective'</span>);
0101 <span class="keyword">else</span>
0102     xyzData.x = x;
0103     xyzData.y = y;
0104     xyzData.z = z;
0105 <span class="keyword">end</span>
0106 
0107 <span class="keyword">return</span>;
0108</pre></div>
<hr><address>Generated on Wed 05-Dec-2012 12:03:42 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>