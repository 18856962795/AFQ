<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of dtiGetBrainLabel</title>
  <meta name="keywords" content="dtiGetBrainLabel">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">templates</a> &gt; <a href="index.html">labelMaps</a> &gt; dtiGetBrainLabel.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for templates/labelMaps&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>dtiGetBrainLabel
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [labelTxt, labelNum] = dtiGetBrainLabel(ssCoords, labelType) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">
 labelTxt = dtiGetBrainLabel(ssCoords, labelType)

 Given the proper standard-space coordinates (usually MNI), returns the
 text label from a label map atlas. Call this function with no arguments
 to get a list of available label maps.

 E.g.:
 dtiGetBrainLabel([7 -95 0], 'MNI_AAL')      % returns 'Calcarine_R'
 dtiGetBrainLabel([7 -95 0], 'MNI_Brodmann') % returns 'Brodmann_Area_17'

 For help in getting an image-to-MNI transform, see the code snippets at
 the bottom of this file.
 
 HISTORY:
 2007.07.17 RFD: wrote it.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="dtiGetBrainLabel.html" class="code" title="function [labelTxt, labelNum] = dtiGetBrainLabel(ssCoords, labelType)">dtiGetBrainLabel</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="dtiGetBrainLabel.html" class="code" title="function [labelTxt, labelNum] = dtiGetBrainLabel(ssCoords, labelType)">dtiGetBrainLabel</a>	</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [availableMaps,mapDir] = getAvailableLabelMaps()</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [labelTxt, labelNum] = dtiGetBrainLabel(ssCoords, labelType)</a>
0002 <span class="comment">%</span>
0003 <span class="comment">% labelTxt = dtiGetBrainLabel(ssCoords, labelType)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Given the proper standard-space coordinates (usually MNI), returns the</span>
0006 <span class="comment">% text label from a label map atlas. Call this function with no arguments</span>
0007 <span class="comment">% to get a list of available label maps.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% E.g.:</span>
0010 <span class="comment">% dtiGetBrainLabel([7 -95 0], 'MNI_AAL')      % returns 'Calcarine_R'</span>
0011 <span class="comment">% dtiGetBrainLabel([7 -95 0], 'MNI_Brodmann') % returns 'Brodmann_Area_17'</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% For help in getting an image-to-MNI transform, see the code snippets at</span>
0014 <span class="comment">% the bottom of this file.</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% HISTORY:</span>
0017 <span class="comment">% 2007.07.17 RFD: wrote it.</span>
0018 <span class="comment">%</span>
0019 
0020 <span class="keyword">persistent</span> labelMaps;
0021 
0022 <span class="keyword">if</span>(nargin==0)
0023    <span class="comment">% Return a list of all available label maps.</span>
0024    labelTxt = <a href="#_sub1" class="code" title="subfunction [availableMaps,mapDir] = getAvailableLabelMaps()">getAvailableLabelMaps</a>();
0025    <span class="keyword">return</span>;
0026 <span class="keyword">end</span>
0027 
0028 <span class="keyword">if</span>(~exist(<span class="string">'labelType'</span>,<span class="string">'var'</span>)||isempty(labelType))
0029     labelType = <span class="string">'MNI_AAL'</span>;
0030 <span class="keyword">end</span>
0031 
0032 <span class="keyword">if</span>(isempty(labelMaps))
0033     [labelMaps.availableMaps,labelMaps.mapDir] = <a href="#_sub1" class="code" title="subfunction [availableMaps,mapDir] = getAvailableLabelMaps()">getAvailableLabelMaps</a>();
0034     labelMaps.maps = cell(size(labelMaps.availableMaps));
0035 <span class="keyword">end</span>
0036 
0037 mapNum = strmatch(labelType,labelMaps.availableMaps);
0038 <span class="keyword">if</span>(isempty(mapNum))
0039     error([<span class="string">'Map type '''</span> labelType <span class="string">''' not found.'</span>]);
0040 <span class="keyword">end</span>
0041 
0042 <span class="keyword">if</span>(isempty(labelMaps.maps)||isempty(labelMaps.maps{mapNum}))
0043     labelMaps.maps{mapNum} = readFileNifti(fullfile(labelMaps.mapDir, [labelType <span class="string">'.nii.gz'</span>]));
0044     tmp = readTab(fullfile(labelMaps.mapDir, [labelType <span class="string">'.txt'</span>]),<span class="string">','</span>,false);
0045     <span class="comment">% FIXME- make this more robust</span>
0046     labelMaps.maps{mapNum}.labelTxt = tmp(:,2);
0047 <span class="keyword">end</span>
0048 
0049 ic = round(mrAnatXformCoords(labelMaps.maps{mapNum}.qto_ijk, double(ssCoords)));
0050 <span class="comment">% Do a boundary check before just using these coordinates to lookup</span>
0051 szMap = size(labelMaps.maps{mapNum}.data);
0052 <span class="keyword">if</span> any(ic&gt;szMap) || any(ic&lt;1)
0053     labelNum=0;
0054 <span class="keyword">else</span>
0055     labelNum = labelMaps.maps{mapNum}.data(ic(1),ic(2),ic(3));
0056 <span class="keyword">end</span>
0057 
0058 <span class="keyword">if</span>(labelNum&gt;0)
0059     labelTxt = labelMaps.maps{mapNum}.labelTxt{labelNum};
0060 <span class="keyword">else</span>
0061     labelTxt = <span class="string">'none'</span>;
0062 <span class="keyword">end</span>
0063 
0064 <span class="keyword">return</span>
0065 
0066 <a name="_sub1" href="#_subfunctions" class="code">function [availableMaps,mapDir] = getAvailableLabelMaps()</a>
0067    mapDir = fileparts(which(mfilename));
0068    d = dir(fullfile(mapDir,<span class="string">'*.txt'</span>));
0069    <span class="keyword">for</span>(ii=1:length(d))
0070     [junk,availableMaps{ii}] = fileparts(d(ii).name);
0071    <span class="keyword">end</span>
0072 <span class="keyword">return</span>
0073 
0074 
0075 
0076 <span class="comment">% To get labels for an individual brain:</span>
0077 mni = readFileNifti(<span class="string">'/home/bob/cvs/VISTASOFT/mrDiffusion/templates/MNI_T1.nii.gz'</span>);
0078 t1 = readFileNifti(<span class="string">'/biac3/wandell4/data/reading_longitude/dti_adults/as050307/bin/backgrounds/t1.nii.gz'</span>);
0079 <span class="comment">% Compute the spatial normalization (maps template voxels to image voxels)</span>
0080 sn = mrAnatComputeSpmSpatialNorm(double(t1.data), t1.qto_xyz, mni);
0081 <span class="comment">% Invert the spatial norm to map image voxels to template voxels</span>
0082 [defX, defY, defZ] = mrAnatInvertSn(sn);
0083 <span class="comment">% Convert the image-to-template defomration to a compact look-up table.</span>
0084 <span class="comment">% NOTE: to save space and time, we use int16.</span>
0085 defX(isnan(defX)) = 0; defY(isnan(defY)) = 0; defZ(isnan(defZ)) = 0;
0086 coordLUT = int16(round(cat(4,defX,defY,defZ)));
0087 intentCode = 1006;   <span class="comment">% NIFTI_INTENT_DISPVECT=1006</span>
0088 intentName = <span class="string">'ToMNI'</span>;
0089 <span class="comment">% NIFTI format requires that the 4th dim is always time, so we put the</span>
0090 <span class="comment">% deformation vector [x,y,z] in the 5th dimension.</span>
0091 tmp = reshape(coordLUT,[size(defX) 1 3]);
0092 lutFile = <span class="string">'/biac3/wandell4/data/reading_longitude/dti_adults/as050307/MNI_coordLUT.nii.gz'</span>;
0093 dtiWriteNiftiWrapper(tmp,sn.VF.mat,lutFile,1,<span class="string">''</span>,intentName,intentCode);
0094 
0095 <span class="comment">% To use the transform:</span>
0096 ni = readFileNifti(lutFile);
0097 xform.coordLUT = ni.data;
0098 xform.inMat = ni.qto_ijk;
0099 t1AcpcCoords = [5 -90 -4]; 
0100 <span class="comment">% to use native image-space coords:</span>
0101 <span class="comment">% t1AcpcCoords = mrAnatXformCoords(t1.qto_xyz,[86 31 57]);</span>
0102 mniCoords = mrAnatXformCoords(xform, t1AcpcCoords);
0103 <a href="dtiGetBrainLabel.html" class="code" title="function [labelTxt, labelNum] = dtiGetBrainLabel(ssCoords, labelType)">dtiGetBrainLabel</a>(mniCoords, <span class="string">'MNI_AAL'</span>)
0104 <a href="dtiGetBrainLabel.html" class="code" title="function [labelTxt, labelNum] = dtiGetBrainLabel(ssCoords, labelType)">dtiGetBrainLabel</a>(mniCoords, <span class="string">'MNI_Brodmann'</span>)</pre></div>
<hr><address>Generated on Wed 14-Nov-2012 17:12:08 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>