<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of AFQ_example_GroupComparison</title>
  <meta name="keywords" content="AFQ_example_GroupComparison">
  <meta name="description" content="% Run AFQ analysis for 2 groups (patients and controls)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">tutorials</a> &gt; AFQ_example_GroupComparison.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for tutorials&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>AFQ_example_GroupComparison
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>% Run AFQ analysis for 2 groups (patients and controls)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Run AFQ analysis for 2 groups (patients and controls)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../3Dvis/AFQ_AddImageTo3dPlot.html" class="code" title="function h = AFQ_AddImageTo3dPlot(nifti, slice, cmap, rescale, alpha, varargin)">AFQ_AddImageTo3dPlot</a>	Add a slice from a nifti image to a 3D plot</li><li><a href="../3Dvis/AFQ_RenderFibers.html" class="code" title="function lightH = AFQ_RenderFibers(fg,varargin)">AFQ_RenderFibers</a>	Render a fiber group and tract profile in 3-D</li><li><a href="../3Dvis/AFQ_RenderRoi.html" class="code" title="function h = AFQ_RenderRoi(roi, color, method, render, varargin)">AFQ_RenderRoi</a>	Render an ROI as a 3D surface</li><li><a href="../functions/AFQ_ComputeTractProperties.html" class="code" title="function [fa, md, rd, ad, cl, TractProfile] = AFQ_ComputeTractProperties(fg_classified,dt,numberOfNodes,clip2rois,subDir, weighting, afq)">AFQ_ComputeTractProperties</a>	Compute diffusion properties along the trajectory of the fiber groups.</li><li><a href="../functions/AFQ_Create.html" class="code" title="function afq = AFQ_Create(varargin)">AFQ_Create</a>	Create AFQ structure and set default parameters</li><li><a href="../functions/AFQ_LoadROIs.html" class="code" title="function [roi1, roi2] = AFQ_LoadROIs(fgNumber,sub_dir, afq)">AFQ_LoadROIs</a>	Load the two ROIs used to define a fiber group</li><li><a href="../functions/AFQ_TractProfileSet.html" class="code" title="function TractProfile = AFQ_TractProfileSet(TractProfile,param,varargin)">AFQ_TractProfileSet</a>	Set fields of the afq TractProfile structure</li><li><a href="../functions/AFQ_directories.html" class="code" title="function [AFQbase AFQdata AFQfunc AFQutil AFQdoc AFQgui] = AFQ_directories">AFQ_directories</a>	Returns a path to the AFQ directories</li><li><a href="../functions/AFQ_run.html" class="code" title="function [afq patient_data control_data norms abn abnTracts] = AFQ_run(sub_dirs, sub_group, afq)">AFQ_run</a>	Run AFQ analysis on a set of subjects to generate Tract Profiles of white</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% Run AFQ analysis for 2 groups (patients and controls)</span>
0002 
0003 <span class="comment">% Get the path to the AFQ directories</span>
0004 [AFQbase AFQdata] = <a href="../functions/AFQ_directories.html" class="code" title="function [AFQbase AFQdata AFQfunc AFQutil AFQdoc AFQgui] = AFQ_directories">AFQ_directories</a>;
0005 <span class="comment">% Create a cell array where each cell is the path to a data directory</span>
0006 sub_dirs = {[AFQdata <span class="string">'/patient_01/dti30'</span>], [AFQdata <span class="string">'/patient_02/dti30'</span>]<span class="keyword">...</span>
0007     [AFQdata <span class="string">'/patient_03/dti30'</span>], [AFQdata <span class="string">'/control_01/dti30'</span>]<span class="keyword">...</span>
0008     [AFQdata <span class="string">'/control_02/dti30'</span>], [AFQdata <span class="string">'/control_03/dti30'</span>]};
0009 <span class="comment">% Create a vector of 0s and 1s defining who is a patient and a control</span>
0010 sub_group = [1, 1, 1, 0, 0, 0];
0011 <span class="comment">% Run AFQ in test mode to save time and do not show figures. No inputs are</span>
0012 <span class="comment">% needed to run AFQ with the default settings. AFQ_Create builds the afq</span>
0013 <span class="comment">% structure. This will also be done automatically by AFQ_run if the user</span>
0014 <span class="comment">% does not wish to modify any parameters</span>
0015 afq = <a href="../functions/AFQ_Create.html" class="code" title="function afq = AFQ_Create(varargin)">AFQ_Create</a>(<span class="string">'run_mode'</span>,<span class="string">'test'</span>, <span class="string">'sub_dirs'</span>, sub_dirs, <span class="string">'sub_group'</span>,<span class="keyword">...</span>
0016     sub_group, <span class="string">'showfigs'</span>,false);
0017 <span class="comment">% Run AFQ to generate the fiber tracts</span>
0018 [afq patient_data control_data norms abn abnTracts] = <a href="../functions/AFQ_run.html" class="code" title="function [afq patient_data control_data norms abn abnTracts] = AFQ_run(sub_dirs, sub_group, afq)">AFQ_run</a>(sub_dirs, sub_group, afq);
0019 
0020 <span class="comment">%% Run a t-test to compare FA along each fiber tract for patients vs. controls</span>
0021 
0022 <span class="comment">% Loop over all 20 fiber groups</span>
0023 <span class="keyword">for</span> jj = 1:20
0024     <span class="comment">% Run an independent samples t-test comparing FA values between the</span>
0025     <span class="comment">% groups at each point along each tract</span>
0026     [h(jj,:),p(jj,:),~,Tstats(jj)] = ttest2(afq.patient_data(jj).FA,afq.control_data(jj).FA);
0027 <span class="keyword">end</span>
0028 
0029 <span class="comment">%% Make Tract Profiles of T statistics</span>
0030 
0031 <span class="comment">% Load the cleaned segmented fibers for the first control subject</span>
0032 fg = dtiReadFibers(fullfile(sub_dirs{3},<span class="string">'fibers'</span>,<span class="string">'MoriGroups_clean_D5_L4.mat'</span>));
0033 <span class="comment">% Load the subject's dt6 file</span>
0034 dt = dtiLoadDt6(fullfile(sub_dirs{3},<span class="string">'dt6.mat'</span>));
0035 <span class="comment">% Compute Tract Profiles with 100 nodes</span>
0036 numNodes = 100;
0037 [fa md rd ad cl TractProfile] = <a href="../functions/AFQ_ComputeTractProperties.html" class="code" title="function [fa, md, rd, ad, cl, TractProfile] = AFQ_ComputeTractProperties(fg_classified,dt,numberOfNodes,clip2rois,subDir, weighting, afq)">AFQ_ComputeTractProperties</a>(fg,dt,numNodes);
0038 <span class="comment">% Add the pvalues and T statistics from the group comparison to the tract</span>
0039 <span class="comment">% profile. This same code could be used to add correlation coeficients or</span>
0040 <span class="comment">% other statistics</span>
0041 <span class="keyword">for</span> jj = 1:20
0042     TractProfile(jj) = <a href="../functions/AFQ_TractProfileSet.html" class="code" title="function TractProfile = AFQ_TractProfileSet(TractProfile,param,varargin)">AFQ_TractProfileSet</a>(TractProfile(jj),<span class="string">'vals'</span>,<span class="string">'pval'</span>,p(jj,:));
0043     TractProfile(jj) = <a href="../functions/AFQ_TractProfileSet.html" class="code" title="function TractProfile = AFQ_TractProfileSet(TractProfile,param,varargin)">AFQ_TractProfileSet</a>(TractProfile(jj),<span class="string">'vals'</span>,<span class="string">'Tstat'</span>,Tstats(jj).tstat);
0044 <span class="keyword">end</span>
0045 
0046 <span class="comment">%% Render The tract Profiles of T statistics</span>
0047 
0048 <span class="comment">% The hot colormap is a good one because it will allow us to make regions</span>
0049 <span class="comment">% of the profile where p&gt;0.05 black.</span>
0050 cmap = <span class="string">'hot'</span>;
0051 <span class="comment">% Set the color range to black out non significant regions of the tract. We</span>
0052 <span class="comment">% will render the T-stat profile such that T statistics greater than 5 will</span>
0053 <span class="comment">% be white and T statistics less than 1 will be black. Obviously a T value</span>
0054 <span class="comment">% of 1 is not considered significant however in this example we only have 3</span>
0055 <span class="comment">% subjects in each group hence we use a low value just to demonstrate the</span>
0056 <span class="comment">% proceedure.</span>
0057 crange = [1 4];
0058 <span class="comment">% Set the number of fibers to render. More fibers takes longer</span>
0059 numfibers = 200;
0060 <span class="comment">% Render the left corticospinal tract (fibers colored light blue) with a</span>
0061 <span class="comment">% Tract Profile of T statistics. Each fiber will have a 1mm radius and the</span>
0062 <span class="comment">% tract profile will have a 6mm radius.</span>
0063 <a href="../3Dvis/AFQ_RenderFibers.html" class="code" title="function lightH = AFQ_RenderFibers(fg,varargin)">AFQ_RenderFibers</a>(fg(3),<span class="string">'color'</span>,[.8 .8 1],<span class="string">'tractprofile'</span>,TractProfile(3),<span class="keyword">...</span>
0064     <span class="string">'val'</span>,<span class="string">'Tstat'</span>,<span class="string">'numfibers'</span>,numfibers,<span class="string">'cmap'</span>,cmap,<span class="string">'crange'</span>,crange,<span class="keyword">...</span>
0065     <span class="string">'radius'</span>,[1 6]);
0066 <span class="comment">% Add the defining ROIs to the rendering.</span>
0067 [roi1 roi2] = <a href="../functions/AFQ_LoadROIs.html" class="code" title="function [roi1, roi2] = AFQ_LoadROIs(fgNumber,sub_dir, afq)">AFQ_LoadROIs</a>(3,sub_dirs{3});
0068 <span class="comment">% The rois will be rendered in dark blue</span>
0069 <a href="../3Dvis/AFQ_RenderRoi.html" class="code" title="function h = AFQ_RenderRoi(roi, color, method, render, varargin)">AFQ_RenderRoi</a>(roi1,[0 0 .7]);
0070 <a href="../3Dvis/AFQ_RenderRoi.html" class="code" title="function h = AFQ_RenderRoi(roi, color, method, render, varargin)">AFQ_RenderRoi</a>(roi2,[0 0 .7]);
0071 <span class="comment">% Add the slice x=-15 from the subject's b=0 image</span>
0072 b0 = readFileNifti(dt.files.b0);
0073 <a href="../3Dvis/AFQ_AddImageTo3dPlot.html" class="code" title="function h = AFQ_AddImageTo3dPlot(nifti, slice, cmap, rescale, alpha, varargin)">AFQ_AddImageTo3dPlot</a>(b0,[-15,0,0]);</pre></div>
<hr><address>Generated on Wed 05-Dec-2012 12:03:42 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>