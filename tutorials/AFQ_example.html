
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>AFQ_example</title><meta name="generator" content="MATLAB 8.3"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-02-03"><meta name="DC.source" content="AFQ_example.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">Example AFQ analysis</a></li><li><a href="#2">Step 1: Whole-brain tractography.</a></li><li><a href="#3">Step 2: Fiber tract segmentation</a></li><li><a href="#4">Step 3: Fiber tract cleaning</a></li><li><a href="#5">Step 4: Compute tract profiles</a></li><li><a href="#6">Step 5: Render Tract Profiles</a></li></ul></div><h2>Example AFQ analysis<a name="1"></a></h2><pre class="codeinput"><span class="comment">% This will give an example of how to run each step in the AFQ pipeline for</span>
<span class="comment">% a single example subject's dataset that is included in the AFQ software.</span>
<span class="comment">% Once you add AFQ to your matlab search path you should be able to run all</span>
<span class="comment">% this code without any modifications.</span>
</pre><h2>Step 1: Whole-brain tractography.<a name="2"></a></h2><pre class="codeinput"><span class="comment">% First we can use AFQ_directories to find the directories that contain the</span>
<span class="comment">% AFQ software and data on your local machine.</span>
[AFQbase AFQdata AFQfunc AFQutil AFQdoc AFQgui] = AFQ_directories;

<span class="comment">% The directory path to the first example subject within the AFQdata folder</span>
<span class="comment">% will be:</span>
sub_dir = fullfile(AFQdata, <span class="string">'control_01'</span>, <span class="string">'dti30'</span>);

<span class="comment">% Load the subject's dt6 file (generated from dtiInit).</span>
dt = dtiLoadDt6(fullfile(sub_dir,<span class="string">'dt6.mat'</span>));

<span class="comment">% Track every fiber from a mask of white matter voxels. Use 'test' mode to</span>
<span class="comment">% track fewer fibers and make the example run quicker.</span>
wholebrainFG = AFQ_WholebrainTractography(dt,<span class="string">'test'</span>);

<span class="comment">% Visualize the wholebrain fiber group.  Because there are a few hundred</span>
<span class="comment">% thousand fibers we will use the 'numfibers' input to AFQ_RenderFibers to</span>
<span class="comment">% randomly select 1,000 fibers to render. The 'color' input is used to set</span>
<span class="comment">% the rgb values that specify the desired color of the fibers.</span>
AFQ_RenderFibers(wholebrainFG, <span class="string">'numfibers'</span>,1000, <span class="string">'color'</span>, [1 .6 .2]);

<span class="comment">% Add a sagittal slice from the subject's b0 image to the plot. First load</span>
<span class="comment">% the b0 image.</span>
b0 = readFileNifti(fullfile(sub_dir,<span class="string">'bin'</span>,<span class="string">'b0.nii.gz'</span>));

<span class="comment">% Then add the slice X = -2 to the 3d rendering.</span>
AFQ_AddImageTo3dPlot(b0,[-2, 0, 0]);
</pre><pre class="codeoutput">
scale=[2.0,2.0,2.0]mm, track=1, interp=1, step=1.0mm, fa=0.20, angle=30.0deg, puncture=0.20, minLength=50.0mm, maxLength=250.0mm
Tracking 124442 fibers (1556 fibers per tick):
................................................................................
32704 fibers passed length threshold of 50.0 (out of 124442 seeds).
Elapsed time is 72.827790 seconds.
32704 fibers, mean length 94mm (max 251mm; min 50mm).

mesh can be rotated with arrow keys
</pre><img vspace="5" hspace="5" src="AFQ_example_01.png" alt=""> <h2>Step 2: Fiber tract segmentation<a name="3"></a></h2><pre class="codeinput"><span class="comment">% Segment the whole-brain fiber group into 20 fiber tracts</span>
fg_classified = AFQ_SegmentFiberGroups(dt, wholebrainFG);

<span class="comment">% fg_classified.subgroup defines the fascicle that each fiber belongs to.</span>
<span class="comment">% We can convert fg_classified to a 1x20 structured array of fiber groups</span>
<span class="comment">% where each entry in the array is a segmented fiber tract. For example</span>
<span class="comment">% fg_classified(3) is the left corticospinal tract, fg_classified(11) is</span>
<span class="comment">% the left inferior fronto-occipital fasciculus (IFOF), fg_classified(17)</span>
<span class="comment">% is the left uncinate fasiculus,  and fg_classified(19) is the left</span>
<span class="comment">% arcuate fasciculus.</span>
fg_classified = fg2Array(fg_classified);

<span class="comment">% Render 400 corticospinal tract fibers in blue.</span>
AFQ_RenderFibers(fg_classified(3),<span class="string">'numfibers'</span>,400,<span class="string">'color'</span>,[0 0 1]);

<span class="comment">% Render 400 IFOF fibers in green. To add this tract to the same</span>
<span class="comment">% plotting window set the 'newfig' input to false.</span>
AFQ_RenderFibers(fg_classified(11),<span class="string">'numfibers'</span>,400,<span class="string">'color'</span>,[0 1 0],<span class="string">'newfig'</span>,false)

<span class="comment">% Render 400 uncinate fibers in yellow</span>
AFQ_RenderFibers(fg_classified(17),<span class="string">'numfibers'</span>,400,<span class="string">'color'</span>,[1 1 0],<span class="string">'newfig'</span>,false)

<span class="comment">% Render 400 arcuate fibers in green.</span>
AFQ_RenderFibers(fg_classified(19),<span class="string">'numfibers'</span>,400,<span class="string">'color'</span>,[1 0 0],<span class="string">'newfig'</span>,false)

<span class="comment">% Then add the slice X = -2 to the 3d rendering.</span>
AFQ_AddImageTo3dPlot(b0,[-2, 0, 0]);
</pre><pre class="codeoutput">You chose to recompute ROIs
Fibers that get as close to the ROIs as 2mm will become candidates for the Mori Groups
Direct calls to spm_defauts are deprecated.
Please use spm('Defaults',modality) or spm_get_defaults instead.
Smoothing by 0 &amp; 8mm..
Coarse Affine Registration..
Fine Affine Registration..
3D CT Norm...
 iteration  1:  FWHM =  13.31 Var = 24.3369
 iteration  2:  FWHM =  10.26 Var = 2.3268
 iteration  3:  FWHM =    9.9 Var = 1.82368
 iteration  4:  FWHM =  9.811 Var = 1.68895
 iteration  5:  FWHM =  9.746 Var = 1.62451
 iteration  6:  FWHM =  9.729 Var = 1.60517
 iteration  7:  FWHM =  9.714 Var = 1.59288
 iteration  8:  FWHM =  9.708 Var = 1.5878
 iteration  9:  FWHM =    9.7 Var = 1.58208
 iteration 10:  FWHM =  9.701 Var = 1.58178
 iteration 11:  FWHM =  9.698 Var = 1.58025
 iteration 12:  FWHM =  9.698 Var = 1.57987
 iteration 13:  FWHM =  9.697 Var = 1.57926
 iteration 14:  FWHM =  9.697 Var = 1.57926
 iteration 15:  FWHM =  9.696 Var = 1.57881
 iteration 16:  FWHM =  9.697 Var = 1.57881
Computing inverse deformation...
dtiCleanFibers: Keeping 32549 out of 32704 fibers.
dtiSplitInterhemisphericFibers: Splitting every fiber below Z=-10 

mesh can be rotated with arrow keys

ans =

     []


ans =

     []


ans =

     []

</pre><img vspace="5" hspace="5" src="AFQ_example_02.png" alt=""> <h2>Step 3: Fiber tract cleaning<a name="4"></a></h2><pre class="codeinput"><span class="comment">% Even though the fiber tracts produced by AFQ_SegementFiberGroups conform</span>
<span class="comment">% to the cannonical definition of the of each tract, there are still some</span>
<span class="comment">% abherrant fibers that deviate from the core of the fascicle. For example</span>
<span class="comment">% notice for the uncinate a few fibers deviate from the typical trajectory</span>
<span class="comment">% and take a weird loop. AFQ_removeFiberOutliers can be used to identify</span>
<span class="comment">% and remove abherrant fibers.</span>

<span class="comment">% Create a new variable for the left uncinate</span>
uf = fg_classified(17);
<span class="comment">% Remove fibers more than maxDist standard deviations from the tract core</span>
maxDist = 4;
<span class="comment">% Remove fibers more than maxLen standard deviations above the mean length</span>
maxLen = 4;
<span class="comment">% Sample each fiber to numNodes points</span>
numNodes = 30;
<span class="comment">% Compute the tract core with the function M</span>
M = <span class="string">'mean'</span>;
<span class="comment">% Maximum number of iterations</span>
maxIter = 1;
<span class="comment">% Display the number of fibers removed in each iteration</span>
count = true;

<span class="comment">% Begin cleaning the uncinate</span>
uf_clean = AFQ_removeFiberOutliers(uf,maxDist,maxLen,numNodes,M,count,maxIter);

<span class="comment">% Notice that the final fiber group is much cleaner than the origional.</span>
<span class="comment">% There are not as many long looping fibers that deviate from the fascicle.</span>
AFQ_RenderFibers(uf,<span class="string">'numfibers'</span>,1000,<span class="string">'color'</span>,[1 1 0]);
title(<span class="string">'Uncinate before cleaning'</span>,<span class="string">'fontsize'</span>,18)
AFQ_RenderFibers(uf_clean,<span class="string">'numfibers'</span>,1000,<span class="string">'color'</span>,[.5 .5 0]);
title(<span class="string">'Uncinate after cleaning'</span>,<span class="string">'fontsize'</span>,18)

<span class="comment">% Loop over all 20 fiber groups and clean each one</span>
<span class="keyword">for</span> ii = 1:20
    fg_clean(ii) = AFQ_removeFiberOutliers(fg_classified(ii),maxDist,maxLen,numNodes,M,count,maxIter);
<span class="keyword">end</span>
</pre><pre class="codeoutput">
Left Uncinate number of fibers: 227 
Left Uncinate number of fibers: 213 
mesh can be rotated with arrow keys

mesh can be rotated with arrow keys

Left Thalamic Radiation number of fibers: 347 
Left Thalamic Radiation number of fibers: 313 
Right Thalamic Radiation number of fibers: 408 
Right Thalamic Radiation number of fibers: 370 
Left Corticospinal number of fibers: 1038 
Left Corticospinal number of fibers: 971 
Right Corticospinal number of fibers: 1310 
Right Corticospinal number of fibers: 1266 
Left Cingulum Cingulate number of fibers: 119 
Left Cingulum Cingulate number of fibers: 106 
Right Cingulum Cingulate number of fibers: 49 
Right Cingulum Cingulate number of fibers: 40 
Left Cingulum Hippocampus number of fibers: 103 
Left Cingulum Hippocampus number of fibers: 95 
Right Cingulum Hippocampus number of fibers: 77 
Callosum Forceps Major number of fibers: 301 
Callosum Forceps Major number of fibers: 287 
Callosum Forceps Minor number of fibers: 1198 
Callosum Forceps Minor number of fibers: 1169 
Left IFOF number of fibers: 429 
Left IFOF number of fibers: 390 
Right IFOF number of fibers: 298 
Right IFOF number of fibers: 272 
Left ILF number of fibers: 170 
Left ILF number of fibers: 159 
Right ILF number of fibers: 314 
Right ILF number of fibers: 289 
Left SLF number of fibers: 216 
Left SLF number of fibers: 198 
Right SLF number of fibers: 382 
Right SLF number of fibers: 367 
Left Uncinate number of fibers: 227 
Left Uncinate number of fibers: 213 
Right Uncinate number of fibers: 491 
Right Uncinate number of fibers: 460 
Left Arcuate number of fibers: 378 
Left Arcuate number of fibers: 349 
Right Arcuate number of fibers: 214 
Right Arcuate number of fibers: 198 </pre><img vspace="5" hspace="5" src="AFQ_example_03.png" alt=""> <img vspace="5" hspace="5" src="AFQ_example_04.png" alt=""> <h2>Step 4: Compute tract profiles<a name="5"></a></h2><pre class="codeinput"><span class="comment">% AFQ_ComputeTractProperties will compute diffusion properties (FA, MD, RD,</span>
<span class="comment">% AD, etc.) at numNodes locations along the trajectory of each fiber tract.</span>
<span class="comment">% The default of the function is to do this computation for the portion of</span>
<span class="comment">% the tract spanning between the two defining ROIs.</span>
numNodes = 100;
[fa md rd ad] = AFQ_ComputeTractProperties(fg_clean, dt, numNodes);

<span class="comment">% Open a new figure window</span>
figure; hold(<span class="string">'on'</span>);
<span class="comment">% Set the coloring of each plot</span>
set(gca,<span class="string">'ColorOrder'</span>,jet(20));
<span class="comment">% Plot the Tract FA Profiles for each tract</span>
plot(fa,<span class="string">'linewidth'</span>,2);
xlabel(<span class="string">'Node'</span>);
ylabel(<span class="string">'Fractional Anisotropy'</span>);
title(<span class="string">'Tract Profiles'</span>);
<span class="comment">% Add a legend with the names of each fiber tract. Here are the names of</span>
<span class="comment">% each fiber group.</span>
fgNames={<span class="string">'Left Thalmic Radiation'</span>,<span class="string">'Right Thalmic Radiation'</span><span class="keyword">...</span>
    <span class="string">'Left Corticospinal'</span>,<span class="string">'Right Corticospinal'</span>, <span class="string">'Left Cingulum Cingulate'</span><span class="keyword">...</span>
    <span class="string">'Right Cingulum Cingulate'</span>, <span class="string">'Left Cingulum Hippocampus'</span><span class="keyword">...</span>
    <span class="string">'Right Cingulum Hippocampus'</span>, <span class="string">'Callosum Forceps Major'</span><span class="keyword">...</span>
    <span class="string">'Callosum Forceps Minor'</span>, <span class="string">'Left IFOF'</span>,<span class="string">'Right IFOF'</span>,<span class="string">'Left ILF'</span><span class="keyword">...</span>
    <span class="string">'Right ILF'</span>,<span class="string">'Left SLF'</span>,<span class="string">'Right SLF'</span>,<span class="string">'Left Uncinate'</span>,<span class="string">'Right Uncinate'</span><span class="keyword">...</span>
    <span class="string">'Left Arcuate'</span>,<span class="string">'Right Arcuate'</span>};
legend(fgNames,<span class="string">'Location'</span>,<span class="string">'EastOutside'</span> );
</pre><img vspace="5" hspace="5" src="AFQ_example_05.png" alt=""> <h2>Step 5: Render Tract Profiles<a name="6"></a></h2><pre class="codeinput"><span class="comment">% Render the Tract FA Profile for the left arcuate fasciculus. When the</span>
<span class="comment">% argument 'dt' is passed in follwed by a variable containing the dt6</span>
<span class="comment">% structure then the tract profile is added to the plot. The colormap</span>
<span class="comment">% denotes the FA value at each point along the tract core.</span>
AFQ_RenderFibers(fg_clean(19),<span class="string">'dt'</span>,dt);

<span class="comment">% Render the Tract FA Profile for the left corticospinal tract</span>
AFQ_RenderFibers(fg_clean(3),<span class="string">'dt'</span>,dt);

<span class="comment">% Render the Tract FA Profile for the left IFOF</span>
AFQ_RenderFibers(fg_clean(11),<span class="string">'dt'</span>,dt);

<span class="comment">% Render the Tract FA Profile for the left uncinate</span>
AFQ_RenderFibers(fg_clean(17),<span class="string">'dt'</span>,dt);
</pre><pre class="codeoutput">
mesh can be rotated with arrow keys

mesh can be rotated with arrow keys

mesh can be rotated with arrow keys

mesh can be rotated with arrow keys
</pre><img vspace="5" hspace="5" src="AFQ_example_06.png" alt=""> <img vspace="5" hspace="5" src="AFQ_example_07.png" alt=""> <img vspace="5" hspace="5" src="AFQ_example_08.png" alt=""> <img vspace="5" hspace="5" src="AFQ_example_09.png" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Example AFQ analysis

% This will give an example of how to run each step in the AFQ pipeline for
% a single example subject's dataset that is included in the AFQ software.
% Once you add AFQ to your matlab search path you should be able to run all
% this code without any modifications.

%% Step 1: Whole-brain tractography. 

% First we can use AFQ_directories to find the directories that contain the
% AFQ software and data on your local machine.
[AFQbase AFQdata AFQfunc AFQutil AFQdoc AFQgui] = AFQ_directories;

% The directory path to the first example subject within the AFQdata folder
% will be:
sub_dir = fullfile(AFQdata, 'control_01', 'dti30');

% Load the subject's dt6 file (generated from dtiInit).
dt = dtiLoadDt6(fullfile(sub_dir,'dt6.mat'));

% Track every fiber from a mask of white matter voxels. Use 'test' mode to
% track fewer fibers and make the example run quicker.
wholebrainFG = AFQ_WholebrainTractography(dt,'test');

% Visualize the wholebrain fiber group.  Because there are a few hundred
% thousand fibers we will use the 'numfibers' input to AFQ_RenderFibers to
% randomly select 1,000 fibers to render. The 'color' input is used to set
% the rgb values that specify the desired color of the fibers.
AFQ_RenderFibers(wholebrainFG, 'numfibers',1000, 'color', [1 .6 .2]);

% Add a sagittal slice from the subject's b0 image to the plot. First load
% the b0 image.
b0 = readFileNifti(fullfile(sub_dir,'bin','b0.nii.gz'));

% Then add the slice X = -2 to the 3d rendering.
AFQ_AddImageTo3dPlot(b0,[-2, 0, 0]);

%% Step 2: Fiber tract segmentation

% Segment the whole-brain fiber group into 20 fiber tracts
fg_classified = AFQ_SegmentFiberGroups(dt, wholebrainFG);

% fg_classified.subgroup defines the fascicle that each fiber belongs to.
% We can convert fg_classified to a 1x20 structured array of fiber groups
% where each entry in the array is a segmented fiber tract. For example
% fg_classified(3) is the left corticospinal tract, fg_classified(11) is
% the left inferior fronto-occipital fasciculus (IFOF), fg_classified(17)
% is the left uncinate fasiculus,  and fg_classified(19) is the left
% arcuate fasciculus.
fg_classified = fg2Array(fg_classified);

% Render 400 corticospinal tract fibers in blue.
AFQ_RenderFibers(fg_classified(3),'numfibers',400,'color',[0 0 1]);

% Render 400 IFOF fibers in green. To add this tract to the same
% plotting window set the 'newfig' input to false.
AFQ_RenderFibers(fg_classified(11),'numfibers',400,'color',[0 1 0],'newfig',false)

% Render 400 uncinate fibers in yellow
AFQ_RenderFibers(fg_classified(17),'numfibers',400,'color',[1 1 0],'newfig',false)

% Render 400 arcuate fibers in green.
AFQ_RenderFibers(fg_classified(19),'numfibers',400,'color',[1 0 0],'newfig',false)

% Then add the slice X = -2 to the 3d rendering.
AFQ_AddImageTo3dPlot(b0,[-2, 0, 0]);

%% Step 3: Fiber tract cleaning

% Even though the fiber tracts produced by AFQ_SegementFiberGroups conform
% to the cannonical definition of the of each tract, there are still some
% abherrant fibers that deviate from the core of the fascicle. For example
% notice for the uncinate a few fibers deviate from the typical trajectory
% and take a weird loop. AFQ_removeFiberOutliers can be used to identify
% and remove abherrant fibers.

% Create a new variable for the left uncinate
uf = fg_classified(17);
% Remove fibers more than maxDist standard deviations from the tract core
maxDist = 4;
% Remove fibers more than maxLen standard deviations above the mean length
maxLen = 4;
% Sample each fiber to numNodes points
numNodes = 30;
% Compute the tract core with the function M
M = 'mean';
% Maximum number of iterations
maxIter = 1;
% Display the number of fibers removed in each iteration
count = true;

% Begin cleaning the uncinate
uf_clean = AFQ_removeFiberOutliers(uf,maxDist,maxLen,numNodes,M,count,maxIter);

% Notice that the final fiber group is much cleaner than the origional.
% There are not as many long looping fibers that deviate from the fascicle.
AFQ_RenderFibers(uf,'numfibers',1000,'color',[1 1 0]);
title('Uncinate before cleaning','fontsize',18)
AFQ_RenderFibers(uf_clean,'numfibers',1000,'color',[.5 .5 0]);
title('Uncinate after cleaning','fontsize',18)

% Loop over all 20 fiber groups and clean each one
for ii = 1:20
    fg_clean(ii) = AFQ_removeFiberOutliers(fg_classified(ii),maxDist,maxLen,numNodes,M,count,maxIter);
end

%% Step 4: Compute tract profiles

% AFQ_ComputeTractProperties will compute diffusion properties (FA, MD, RD,
% AD, etc.) at numNodes locations along the trajectory of each fiber tract.
% The default of the function is to do this computation for the portion of
% the tract spanning between the two defining ROIs.
numNodes = 100;
[fa md rd ad] = AFQ_ComputeTractProperties(fg_clean, dt, numNodes);

% Open a new figure window
figure; hold('on');
% Set the coloring of each plot 
set(gca,'ColorOrder',jet(20));
% Plot the Tract FA Profiles for each tract
plot(fa,'linewidth',2);
xlabel('Node');
ylabel('Fractional Anisotropy');
title('Tract Profiles');
% Add a legend with the names of each fiber tract. Here are the names of
% each fiber group.
fgNames={'Left Thalmic Radiation','Right Thalmic Radiation'...
    'Left Corticospinal','Right Corticospinal', 'Left Cingulum Cingulate'...
    'Right Cingulum Cingulate', 'Left Cingulum Hippocampus'...
    'Right Cingulum Hippocampus', 'Callosum Forceps Major'...
    'Callosum Forceps Minor', 'Left IFOF','Right IFOF','Left ILF'...
    'Right ILF','Left SLF','Right SLF','Left Uncinate','Right Uncinate'...
    'Left Arcuate','Right Arcuate'};
legend(fgNames,'Location','EastOutside' );

%% Step 5: Render Tract Profiles

% Render the Tract FA Profile for the left arcuate fasciculus. When the
% argument 'dt' is passed in follwed by a variable containing the dt6
% structure then the tract profile is added to the plot. The colormap
% denotes the FA value at each point along the tract core.
AFQ_RenderFibers(fg_clean(19),'dt',dt);

% Render the Tract FA Profile for the left corticospinal tract
AFQ_RenderFibers(fg_clean(3),'dt',dt);

% Render the Tract FA Profile for the left IFOF
AFQ_RenderFibers(fg_clean(11),'dt',dt);

% Render the Tract FA Profile for the left uncinate
AFQ_RenderFibers(fg_clean(17),'dt',dt);



##### SOURCE END #####
--></body></html>